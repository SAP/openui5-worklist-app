/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation","./GridItemNavigation","sap/ui/dom/containsOrEquals","sap/ui/thirdparty/jquery","sap/ui/dom/jquery/Selectors"],function(t,e,o,s){"use strict";function i(t){if(t.onfocusin){t.onfocusin()}}var n=e.extend("sap.f.delegate.GridContainerItemNavigation",{constructor:function(){e.apply(this,arguments);this.attachEvent(t.Events.FocusLeave,this._onFocusLeave,this)},metadata:{library:"sap.f",properties:{},events:{}}});n.prototype._onFocusLeave=function(t){var e=this.getFocusedDomRef();this.getItemDomRefs().forEach(function(t,o){if(e===t){var s=o++;this.setFocusedIndex(s)}}.bind(this));this._bFocusLeft=true};n.prototype.forwardTab=function(t){var e=this._getRootDomRefId()+"-"+(t?"after":"before");document.getElementById(e).focus()};n.prototype._getRootDomRefId=function(t){return this.getRootDomRef().getAttribute("id")};n.prototype.onsaptabnext=function(t){var e=this.getItemDomRefs(),o=this.getFocusedIndex(),i=s(e[o]),n=[];var r=i.find(":sapTabbable");r.map(function(t,e){if(e.className.indexOf("DummyArea")===-1){n.push(e)}});var a=s(n),u=a.length===1?0:a.length-1;if(u===-1||a.control(u)&&a.control(u).getId()===t.target.id){this._lastFocusedElement=t.target;this.forwardTab(true)}};n.prototype.onsaptabprevious=function(t){if(!t.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=t.target;return}var e=t.target.id;if(e===this._getRootDomRefId()+"-nodata"){this.forwardTab(false)}this._lastFocusedElement=null;this.forwardTab(false)};n.prototype.onmousedown=function(e){this._bIsMouseDown=true;t.prototype.onmousedown.call(this,e)};n.prototype.onmouseup=function(t){var e=s(t.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),o;if(e.length){o=e.children().eq(0).control()[0];if(o&&o.getFocusDomRef()===document.activeElement){this._lastFocusedElement=null;e.trigger("focus");i(o)}}this._bIsMouseDown=false};n.prototype.ondragend=function(){this._bIsMouseDown=false};n.prototype.ondrop=function(){this._bIsMouseDown=false};n.prototype.onfocusin=function(t){e.prototype.onfocusin.call(this,t);if(t.target===this._getGridInstance().getDomRef("after")&&!this.getRootDomRef().contains(t.relatedTarget)){this._focusPrevious(t);return}var n=s(t.target).closest(".sapFGridContainerItemWrapperNoVisualFocus"),r,a,u,f;if(n.length){r=n.children().eq(0).control()[0];if(r){i(r);if(!this._bIsMouseDown&&r.getFocusDomRef()===t.target){this._lastFocusedElement=null;n.trigger("focus");return}}}if(t.target.classList.contains("sapFGridContainerItemWrapper")){this._lastFocusedElement=null}if(this._bFocusLeft&&!this._bIsMouseDown){a=this.getItemDomRefs();u=this.getFocusedIndex();f=this._lastFocusedElement||a[u];if(!o(f,t.target)){f.focus()}}this._bFocusLeft=false};n.prototype._focusPrevious=function(t){var e=this.getItemDomRefs();var o=this.getFocusedIndex();if(!e.length){return}var i;if(o<0){i=e[0];this.setFocusedIndex(0)}else{i=e[o]}var n=s(i);var r=n.find(":sapTabbable");n.add(r).eq(-1).focus()};n.prototype.focusItem=function(e,o){var i,n,r;if(e===this.iFocusedIndex&&this.aItemDomRefs[this.iFocusedIndex]===document.activeElement){this.fireEvent(t.Events.FocusAgain,{index:e,event:o});return}this.fireEvent(t.Events.BeforeFocus,{index:e,event:o});this.setFocusedIndex(e);this.bISetFocus=true;if(o&&s(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot")){i=s(this.aItemDomRefs[this.iFocusedIndex]).data("sap.INRoot");i._sFocusEvent=o.type}if(!this._bIsMouseDown&&this.aItemDomRefs.length){this.aItemDomRefs[this.iFocusedIndex].focus();n=s(this.aItemDomRefs[this.iFocusedIndex].firstChild).control()[0];if(n){r=n.getFocusDomRef();if(r){this.scrollIntoViewIfNeeded(r)}}}this.fireEvent(t.Events.AfterFocus,{index:e,event:o})};n.prototype.scrollIntoViewIfNeeded=function(t){var e=t.parentElement,o,s;while(e&&e.offsetWidth>=e.scrollWidth&&e.offsetHeight>=e.scrollHeight){e=e.parentElement}if(!e){return}e=e.parentElement;if(!e){return}o=e.getBoundingClientRect();s=t.getBoundingClientRect();if(s.top<o.top||s.bottom>o.bottom||s.right>o.right||s.left<o.left){t.scrollIntoView()}};return n});