/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/delegate/ItemNavigation","sap/ui/events/KeyCodes","sap/base/Log","sap/f/library","sap/ui/thirdparty/jquery"],function(o,e,t,i,n){"use strict";var r=i.NavigationDirection;var s=o.extend("sap.f.delegate.GridItemNavigation",{metadata:{library:"sap.f",properties:{},events:{}}});s.prototype.resetFocusPosition=function(){this._mCurrentPosition=null};s.prototype.onfocusin=function(e){o.prototype.onfocusin.call(this,e);var t=this._getGridInstance().getNavigationMatrix();if(t&&e.target===this.oDomRef){this._mCurrentPosition=this._findPositionInMatrix(t,this.getItemDomRefs().indexOf(this.iFocusedIndex))}};s.prototype.onsapfocusleave=function(e){o.prototype.onsapfocusleave.call(this,e);if(e.target===this.oDomRef){this.resetFocusPosition()}};s.prototype.ontap=function(o){this.resetFocusPosition()};s.prototype.onsapnext=function(o){this._moveFocus(o)};s.prototype.onsapprevious=function(o){this._moveFocus(o)};s.prototype._moveFocus=function(o){var i=this.getItemDomRefs(),n=o.target,r,s;if(i.indexOf(o.target)===-1){return}o.preventDefault();r=this._getGridInstance().getNavigationMatrix();if(!r){return}s=this._findPositionInMatrix(r,n);if(!this._mCurrentPosition){this._mCurrentPosition={column:s.column,row:s.row}}switch(o.keyCode){case e.ARROW_DOWN:this._moveFocusDown(s,r,n,o);break;case e.ARROW_RIGHT:this._moveFocusRight(s,r,n,o);break;case e.ARROW_UP:this._moveFocusUp(s,r,n,o);break;case e.ARROW_LEFT:this._moveFocusLeft(s,r,n,o);break;default:break}t.info("Grid matrix position: ("+s.row+", "+s.column+")")};s.prototype._moveFocusDown=function(o,e,t,i){var n=this.getItemDomRefs(),r;o.column=this._mCurrentPosition.column;while(o.row<e.length&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.row+=1}if(o.row>=e.length){this._onBorderReached(i);return}r=e[o.row][o.column];if(r){this._mCurrentPosition=o;this.focusItem(n.indexOf(r),i)}else{this._onBorderReached(i)}};s.prototype._moveFocusRight=function(o,e,t,i){var n=this.getItemDomRefs(),r;o.row=this._mCurrentPosition.row;while(o.column<e[o.row].length&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.column+=1}if(o.column>=e[o.row].length){this._onBorderReached(i);return}r=e[o.row][o.column];if(r){this._mCurrentPosition=o;this.focusItem(n.indexOf(r),i)}else{this._onBorderReached(i)}};s.prototype._moveFocusUp=function(o,e,t,i){var n=this.getItemDomRefs(),r;o.column=this._mCurrentPosition.column;while(o.row>=0&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.row-=1}if(o.row<0){this._onBorderReached(i);return}r=e[o.row][o.column];if(r){while(o.row>0&&e[o.row-1][o.column]===r){o.row-=1}this._mCurrentPosition=o;this.focusItem(n.indexOf(r),i)}else{this._onBorderReached(i)}};s.prototype._moveFocusLeft=function(o,e,t,i){var n=this.getItemDomRefs(),r;o.row=this._mCurrentPosition.row;while(o.column>=0&&(e[o.row][o.column]===t||e[o.row][o.column]===false)){o.column-=1}if(o.column<0){this._onBorderReached(i);return}r=e[o.row][o.column];if(r){while(o.column>0&&e[o.row][o.column-1]===r){o.column-=1}this._mCurrentPosition=o;this.focusItem(n.indexOf(r),i)}else{this._onBorderReached(i)}};s.prototype._findPositionInMatrix=function(o,e){var t=null;o.some(function(o,i){var n=o.indexOf(e);if(n!==-1){t={};t.row=i;t.column=n;return true}return false});return t};s.prototype._onBorderReached=function(o){var t;switch(o.keyCode){case e.ARROW_RIGHT:t=r.Right;break;case e.ARROW_LEFT:t=r.Left;break;case e.ARROW_DOWN:t=r.Down;break;case e.ARROW_UP:t=r.Up;break}this._getGridInstance().onItemNavigationBorderReached({event:o,row:this._mCurrentPosition.row,column:this._mCurrentPosition.column,direction:t})};s.prototype.focusItemByDirection=function(o,e,t,i){var n,s=o.getNavigationMatrix(),u,c,a;switch(e){case r.Right:c=t;a=-1;u=s[t];if(u){do{n=u[++a]}while(!n)}break;case r.Left:c=t;a=s[0].length;u=s[t];if(u){do{n=u[--a]}while(!n)}if(n){while(a>0&&s[t][a-1]===n){a--}}break;case r.Down:c=-1;a=i;while(!n&&s[++c]&&s[c][i]!==undefined){n=s[c][i]}break;case r.Up:c=s.length;a=i;while(!n&&s[--c]&&s[c][i]!==undefined){n=s[c][i]}if(n){while(c>0&&s[c-1][i]===n){c--}}break;default:break}if(!n){return}this._mCurrentPosition={column:a,row:c};n.focus()};s.prototype._getGridInstance=function(){return n(this.oDomRef).control(0)};return s});