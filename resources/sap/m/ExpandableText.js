/*!
* OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
*/
sap.ui.define(["./library","sap/ui/core/Core","sap/ui/core/Control","sap/ui/core/library","sap/ui/core/InvisibleText","sap/ui/Device","sap/ui/base/ManagedObject","sap/m/Link","sap/m/Text","sap/m/Button","sap/m/ResponsivePopover","sap/m/HyphenationSupport","./ExpandableTextRenderer"],function(e,t,r,a,i,o,n,p,s,l,d,g,u){"use strict";var c=t.getLibraryResourceBundle("sap.m");var h=c.getText("EXPANDABLE_TEXT_SHOW_MORE");var y=c.getText("EXPANDABLE_TEXT_SHOW_LESS");var x=c.getText("MSGBOX_CLOSE");var f=a.TextAlign;var T=a.TextDirection;var _=a.aria.HasPopup;var A=e.WrappingType;var b=e.PlacementType;var v=e.ExpandableTextOverflowMode;var E=e.EmptyIndicatorMode;var m=e.LinkAccessibleRole;function L(e){return e.replace(/ {2,}/g," ").replace(/\t{2,}/g," ")}var P=r.extend("sap.m.ExpandableText",{metadata:{interfaces:["sap.ui.core.IFormContent","sap.m.IHyphenation"],library:"sap.m",properties:{text:{type:"string",defaultValue:"",bindable:"bindable"},textDirection:{type:"sap.ui.core.TextDirection",group:"Appearance",defaultValue:T.Inherit},wrappingType:{type:"sap.m.WrappingType",group:"Appearance",defaultValue:A.Normal},textAlign:{type:"sap.ui.core.TextAlign",group:"Appearance",defaultValue:f.Begin},renderWhitespace:{type:"boolean",group:"Appearance",defaultValue:false},overflowMode:{type:"sap.m.ExpandableTextOverflowMode",group:"Appearance",defaultValue:v.InPlace},maxCharacters:{type:"int",group:"Appearance",defaultValue:100},expanded:{type:"boolean",group:"Appearance",defaultValue:false,visibility:"hidden"},emptyIndicatorMode:{type:"sap.m.EmptyIndicatorMode",group:"Appearance",defaultValue:E.Off}},aggregations:{_showMoreLink:{type:"sap.m.Link",multiple:false,visibility:"hidden"},_ariaLabelledBy:{type:"sap.ui.core.InvisibleText",multiple:false,visibility:"hidden"}},designtime:"sap/m/designtime/ExpandableText.designtime"},renderer:u});P.prototype.init=function(){this.setAggregation("_ariaLabelledBy",new i)};P.prototype.onBeforeRendering=function(){this._updateAriaLabelledByText()};P.prototype.getText=function(e){var t=this.getProperty("text");if(e){return t.replace(/\r\n|\n\r|\r/g,"\n")}return t};P.prototype.getTextDomRef=function(){if(!this.getVisible()){return null}return this.getDomRef("string")};P.prototype._isExpandable=function(){var e=this.getText();if(!this.getRenderWhitespace()){e=L(e)}return e.length>this._getMaxCharacters()+h.length};P.prototype._getMaxCharacters=function(){return Math.max(0,this.getMaxCharacters())};P.prototype._getDisplayedText=function(){var e=this.getText(true);if(this.getProperty("expanded")||!this._isExpandable()){return e}if(!this.getRenderWhitespace()){e=L(e)}return e.substring(0,this._getMaxCharacters())};P.prototype._getShowMoreLink=function(){var e=this.getAggregation("_showMoreLink");if(!e){e=new p(this.getId()+"-showMoreLink",{accessibleRole:m.Button,text:this.getProperty("expanded")?y:h,ariaLabelledBy:this.getAggregation("_ariaLabelledBy"),press:function(t){var r,a,i;if(this.getOverflowMode()===v.InPlace){a=!this.getProperty("expanded");e.setText(a?y:h);this.setProperty("expanded",a)}else{r=new s({text:n.escapeSettingsValue(this.getText()),textDirection:this.getTextDirection(),wrappingType:this.getWrappingType(),textAlign:this.getTextAlign(),renderWhitespace:this.getRenderWhitespace()}).addStyleClass("sapUiSmallMargin").addStyleClass("sapMExTextPopover");i=this._oPopover;if(i&&i.isOpen()){i.close();return}if(!i){i=this._oPopover=new d({showHeader:false,placement:b.HorizontalPreferredRight,beforeClose:this._onPopoverBeforeClose.bind(this)});if(o.system.phone){i.setEndButton(new l({text:x,press:function(){i.close()}}))}this.addDependent(i)}e.setText(y);e.rerender();i.removeAllAriaLabelledBy();i.destroyContent();i.addAriaLabelledBy(r);i.addContent(r);i.openBy(t.getSource());this._updateAriaLabelledByText(true)}}.bind(this)});this.setAggregation("_showMoreLink",e,true)}e.setAriaHasPopup(this.getOverflowMode()===v.InPlace?_.None:_.Dialog);return e};P.prototype._onPopoverBeforeClose=function(){this._getShowMoreLink().setText(h);this._updateAriaLabelledByText()};P.prototype._updateAriaLabelledByText=function(e){var t;e=e||this.getProperty("expanded");switch(this.getOverflowMode()){case v.Popover:t=c.getText(e?"EXPANDABLE_TEXT_SHOW_LESS_POPOVER_ARIA_LABEL":"EXPANDABLE_TEXT_SHOW_MORE_POPOVER_ARIA_LABEL");break;default:t=c.getText(e?"EXPANDABLE_TEXT_SHOW_LESS_ARIA_LABEL":"EXPANDABLE_TEXT_SHOW_MORE_ARIA_LABEL");break}this.getAggregation("_ariaLabelledBy").setText(t)};P.prototype.exit=function(){if(this._oPopover){this._oPopover.destroy();this._oPopover=null}};P.prototype.getAccessibilityInfo=function(){return{description:this.getText()}};P.prototype.getTextsToBeHyphenated=function(){return{main:this._getDisplayedText(true)}};P.prototype.getDomRefsForHyphenatedTexts=function(){return{main:this.getTextDomRef()}};g.mixInto(P.prototype);return P});