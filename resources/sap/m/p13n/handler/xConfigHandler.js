/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/m/p13n/Engine"],function(e){"use strict";var n={};var t=function(e){if(!e._bWaitForModificationChanges&&e.isA){e._bWaitForModificationChanges=true;sap.m.p13n.Engine.getInstance().waitForChanges(e).then(function(){delete e._bWaitForModificationChanges;sap.m.p13n.Engine.getInstance().fireStateChange(e)})}};var a=function(e,n){var t=function(n){if(e._pQueue===n){delete e._pQueue}};e._pQueue=e._pQueue instanceof Promise?e._pQueue.then(n):n();e._pQueue.then(t.bind(null,e._pQueue));return e._pQueue};n.createHandler=function(e){if(!e||!e.hasOwnProperty("property")){throw new Error("Please provide a map containing the affected aggregation and property name!")}var n=e.property;var r;return{changeHandler:{applyChange:function(g,o,i){return a(o,function(){return sap.m.p13n.Engine.getInstance().readXConfig(o,{propertyBag:i}).then(function(t){var a=g.getChangeType().indexOf("add")>-1?"add":"remove";a=g.getChangeType().indexOf("move")===0?"move":a;r=g.getContent().targetAggregation;var p=a!=="add";if(t&&t.aggregations&&t.aggregations[r]&&t.aggregations[r][g.getContent().key]&&t.aggregations[r][g.getContent().key][n]){p=t.aggregations[r][g.getContent().key][n]}g.setRevertData({key:g.getContent().key,value:p});var u={property:n,key:g.getContent().key,value:g.getContent(),operation:a,propertyBag:i};if(e.aggregationBased){u.controlMeta={aggregation:r}}return sap.m.p13n.Engine.getInstance().enhanceXConfig(o,u)}).then(function(){t(o)})})},completeChangeContent:function(e,n,t){},revertChange:function(a,g,o){var i=a.getChangeType().indexOf("add")>-1?"remove":"add";i=a.getChangeType().indexOf("move")===0?"move":i;r=a.getContent().targetAggregation;var p={controlMeta:{aggregation:r,property:n},property:n,operation:i,key:a.getRevertData().key,value:a.getRevertData(),propertyBag:o};if(e.aggregationBased){p.controlMeta={aggregation:r}}return sap.m.p13n.Engine.getInstance().enhanceXConfig(g,p).then(function(){a.resetRevertData();t(g)})}},layers:{USER:true}}};return n});
//# sourceMappingURL=xConfigHandler.js.map