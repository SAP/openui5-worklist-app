/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/util/merge","sap/ui/core/util/reflection/JsControlTreeModifier"],function(e,r){"use strict";var t={};t.enhanceConfig=function(n,a){var o=a.propertyBag;var i=o?o.modifier:r;var g;var u;return i.getControlMetadata(n).then(function(e){g=e;a.controlMetadata=g;return i.getAggregation(n,"customData")}).then(function(e){return Promise.all(e.map(function(e){return i.getProperty(e,"key")})).then(function(r){return e.reduce(function(e,t,n){return r[n]==="xConfig"?t:e},undefined)})}).then(function(r){u=r;if(u){return i.getProperty(u,"value").then(function(r){return e({},JSON.parse(r.replace(/\\/g,"")))})}return{aggregations:{},properties:{}}}).then(function(r){var g;if(a.controlMeta&&a.controlMeta.aggregation){g=t.createAggregationConfig(n,a,r)}else{g=t.createPropertyConfig(n,a,r)}var f=o?o.appComponent:undefined;var s=Promise.resolve();if(u&&n.isA){s=i.removeAggregation(n,"customData",u).then(function(){return i.destroy(u)})}return s.then(function(){return i.createAndAddCustomData(n,"xConfig",JSON.stringify(g),f).then(function(){return e({},g)})})})};t.readConfig=function(t,n){var a,o;if(n){var i=n.propertyBag?n.propertyBag.modifier:r;return i.getAggregation(t,"customData").then(function(e){return Promise.all(e.map(function(e){return i.getProperty(e,"key")})).then(function(r){return e.reduce(function(e,t,n){return r[n]==="xConfig"?t:e},undefined)})}).then(function(r){if(r){return i.getProperty(r,"value").then(function(r){return e({},JSON.parse(r.replace(/\\/g,"")))})}return null})}var g=function(e,r){var t=function(e,r){if(e){if(e.getMetadata){var t=e.getMetadata();var n=t.getAllAggregations();if(n){return n[r]}}}return undefined};var n=t(e,r);if(n){return e[n._sGetter]()}return undefined};var u=function(e,r){var t=e.getMetadata().getPropertyLikeSetting(r);if(t){var n=t._sGetter;return e[n]()}return undefined};o=g(t,"customData").find(function(e){return u(e,"key")=="xConfig"});a=o?e({},JSON.parse(u(o,"value").replace(/\\/g,""))):null;return a};t.createAggregationConfig=function(e,r,t){var n=r.key;var a=r.controlMeta;var o=r.property;var i=r.value;var g=r.controlMetadata||e.getMetadata();var u=a.aggregation;var f=u?u:g.getDefaultAggregation().key;var s=t||{aggregations:{}};if(!s.aggregations.hasOwnProperty(f)){if(g.hasAggregation(f)){s.aggregations[f]={}}else{throw new Error("The aggregation "+f+" does not exist for"+e)}}if(!s.aggregations[f].hasOwnProperty(n)){s.aggregations[f][n]={}}if(i!==null){switch(r.operation){case"move":s.aggregations[f][n][o]=i.index;break;case"remove":case"add":default:s.aggregations[f][n][o]=i.value;s.aggregations[f][n]["position"]=i.index;break}}else{delete s.aggregations[f][n][o];if(Object.keys(s.aggregations[f][n]).length===0){delete s.aggregations[f][n];if(Object.keys(s.aggregations[f]).length===0){delete s.aggregations[f]}}}return s};t.createPropertyConfig=function(e,r,t){var n=r.value;var a=r.property;var o=t||{properties:{}};if(!o.properties.hasOwnProperty(a)){o.properties[a]=[]}var i=r.operation;var g=o.properties[a].find(function(e){return e.key===r.key});if(g){o.properties[a].splice(o.properties[a].indexOf(g),1)}if(i!=="remove"){o.properties[a].splice(r.value.index,0,n)}return o};return t});
//# sourceMappingURL=xConfigAPI.js.map