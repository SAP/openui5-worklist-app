/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/Object","sap/base/Log","sap/ui/util/ActivityDetection","sap/ui/core/IntervalTrigger","sap/ui/thirdparty/jquery"],function(e,t,i,s,r){"use strict";var n=t.getLogger("sap.ui.core.ResizeHandler",t.Level.ERROR);var o;var a=e.extend("sap.ui.core.ResizeHandler",{constructor:function(){e.apply(this);this.aResizeListeners=[];this.aSuspendedDomRefs=[];this.bRegistered=false;this.mCallbacks=new Map;this.iIdCounter=0;this.fDestroyHandler=this.destroy.bind(this);r(window).on("unload",this.fDestroyHandler);i.attachActivate(u,this);if(o){n.error("ResizeHandler is designed as a singleton and should not be created manually! "+"Please require 'sap/ui/core/ResizeHandler' instead and use the module export directly without using 'new'.")}}});function d(){if(this.bRegistered){this.bRegistered=false;s.removeListener(this.checkSizes,this)}}function u(){if(!this.bRegistered&&this.aResizeListeners.length>0){this.bRegistered=true;s.addListener(this.checkSizes,this)}}a.prototype.destroy=function(e){i.detachActivate(u,this);r(window).off("unload",this.fDestroyHandler);this.aResizeListeners=[];this.aSuspendedDomRefs=[];d.call(this)};a.prototype.attachListener=function(t,i){var s=e.isA(t,"sap.ui.core.Control"),o=t instanceof r,a=s?t.getDomRef():t,d=a?a.offsetWidth:0,f=a?a.offsetHeight:0,h="rs-"+Date.now()+"-"+this.iIdCounter++,l;if(s){l="Control "+t.getId()}else if(t.id){l=t.id}else{l=String(t)}this.aResizeListeners.push({sId:h,oDomRef:s?null:t,oControl:s?t:null,bIsJQuery:o,fHandler:i,iWidth:d,iHeight:f,dbg:l});n.debug("registered "+l);u.call(this);return h};a.prototype.detachListener=function(e){var t=this.aResizeListeners;for(var i=0;i<t.length;i++){if(t[i].sId===e){t.splice(i,1);n.debug("deregistered "+e);break}}if(t.length===0){d.call(this)}};a.prototype.checkSizes=function(){var e=n.isLoggable();if(e){n.debug("checkSizes:")}this.aResizeListeners.forEach(function(t){if(t){var i=!!t.oControl,s=i?t.oControl.getDomRef():t.oDomRef;s=t.bIsJQuery?s[0]:s;if(s&&document.documentElement.contains(s)&&!this._isSuspended(s)){var o=t.iWidth,a=t.iHeight,d=s.offsetWidth,u=s.offsetHeight;if(o!=d||a!=u){t.iWidth=d;t.iHeight=u;var f=r.Event("resize");f.target=s;f.currentTarget=s;f.size={width:d,height:u};f.oldSize={width:o,height:a};f.control=i?t.oControl:null;if(e){n.debug("resize detected for '"+t.dbg+"': "+f.oldSize.width+"x"+f.oldSize.height+" -> "+f.size.width+"x"+f.size.height)}t.fHandler(f)}}}},this);if(a._keepActive!=true&&a._keepActive!=false){a._keepActive=false}if(!i.isActive()&&!a._keepActive){d.call(this)}};a.register=function(e,t){return o.attachListener(e,t)};a.deregister=function(e){o.detachListener(e)};a.deregisterAllForControl=function(e){o.aResizeListeners.filter(function(t){return t&&t.oControl&&t.oControl.getId()===e}).forEach(function(e){a.deregister(e.sId)})};a.suspend=function(e){if(!document.documentElement.contains(e)){return false}if(o.aSuspendedDomRefs.indexOf(e)===-1){o.aSuspendedDomRefs.push(e)}return true};a.resume=function(e){var t=o.aSuspendedDomRefs.indexOf(e);if(t===-1){return false}o.aSuspendedDomRefs.splice(t,1);o.checkSizes();var i=o.mCallbacks.get(e);if(i){for(var s=0;s<i.length;s++){i[s]()}o.mCallbacks.delete(e)}return true};a.prototype._isSuspended=function(e){var t=this.aSuspendedDomRefs,i;for(var s=0;s<t.length;s++){i=t[s];if(i.contains(e)){return i}}return false};a.isSuspended=function(e,t){var i=o._isSuspended(e);if(t&&i){var s=o.mCallbacks.get(i);if(!s){s=[];o.mCallbacks.set(i,s)}if(s.indexOf(t)===-1){s.push(t)}}return!!i};o=new a;return a});