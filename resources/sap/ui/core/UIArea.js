/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/base/ManagedObject","sap/ui/base/ManagedObjectRegistry","./Configuration","./Element","./RenderManager","./FocusHandler","sap/ui/performance/trace/Interaction","sap/ui/util/ActivityDetection","sap/ui/events/KeyCodes","sap/base/Log","sap/base/assert","sap/ui/performance/Measurement","sap/base/util/uid","sap/base/util/isEmptyObject","sap/ui/core/Rendering","sap/ui/events/jquery/EventExtension","sap/ui/events/ControlEvents","sap/ui/events/F6Navigation","sap/ui/dom/_ready","sap/ui/thirdparty/jquery"],function(e,t,n,r,o,i,a,s,d,u,l,f,p,g,c,h,v,y,m,jQuery){"use strict";var b="sap-ui-static";var R=c.getLogger();var C=new o;var I;var A=false;m().then(function(){A=true});h.apply();jQuery(document).on("keydown",function(e){y.handleF6GroupNavigation(e,null)});var E=function(e){return e},N=function(){},k=function(){};if(R.isLoggable()){E=function(e){var t;try{throw new Error}catch(e){t=e.stack||e.stacktrace||(e.sourceURL?e.sourceURL+":"+e.line:null);t=t?t.split(/\n\s*/g).slice(2):undefined}return{obj:e,location:t}};N=function(e,t){var n={},o,i;for(o in t){i=r.registry.get(o);n[o]={type:i?i.getMetadata().getName():t[o].obj===e?"UIArea":"(no such control)",location:t[o].location,reason:t[o].reason}}R.debug("  UIArea '"+e.getId()+"', pending updates: "+JSON.stringify(n,null,"\t"))};k=function(e,t){var n;for(n in t){if(e[n]!=null){if(e[n].obj!==t[n].obj){t[n].reason="replaced during rendering"}else{t[n].reason="invalidated again during rendering"}}else{t[n].reason="invalidated during rendering"}}}}var _=e.extend("sap.ui.core.UIArea",{constructor:function(t){if(arguments.length===0){return}e.apply(this);this.bLocked=false;this.bInitial=true;this.aContentToRemove=[];this.bNeedsRerendering=false;if(t!=null){this._setRootNode(t);this.bNeedsRerendering=this.bNeedsRerendering&&!document.getElementById(t.id+"-Init")}this.mInvalidatedControls={};if(!this.bNeedsRerendering){this.bRenderSelf=false}else{c.invalidateUIArea(this)}},metadata:{publicMethods:["setRootNode","getRootNode","setRootControl","getRootControl","lock","unlock","isLocked"],aggregations:{content:{name:"content",type:"sap.ui.core.Control",multiple:true,singularName:"content"},dependents:{name:"dependents",type:"sap.ui.core.Control",multiple:true}}},insertDependent:function(e,t){return this.insertAggregation("dependents",e,t,true)},addDependent:function(e){return this.addAggregation("dependents",e,true)},removeDependent:function(e){return this.removeAggregation("dependents",e,true)},removeAllDependents:function(){return this.removeAllAggregation("dependents",true)},destroyDependents:function(){return this.destroyAggregation("dependents",true)}});_.prototype.isInvalidateSuppressed=function(){return this.iSuppressInvalidate>0};_.prototype.getId=function(){return this.oRootNode?this.oRootNode.id:null};_.prototype.getUIArea=function(){return this};_.prototype.setRootNode=function(e){this._setRootNode(e)};_.prototype._setRootNode=function(e){if(this.oRootNode===e){return}l(!e||e.nodeType===1&&!jQuery(e).attr("data-sap-ui-area"),"UIArea root node must be a DOMElement");if(this.oRootNode){this._ondetach()}this.deregister();this.oRootNode=e;this.register();if(this.getContent().length>0){this.invalidate()}if(this.oRootNode){this._onattach()}};_.prototype.getRootNode=function(){return this.oRootNode};_.prototype.setRootControl=function(e){this.removeAllContent();this.addContent(e)};_.prototype.getRootControl=function(e){var t=this.getContent();if(t.length>0){if(e>=0&&e<t.length){return t[e]}return t[0]}return null};_.prototype._addRemovedContent=function(e){if(this.oRootNode&&e){this.aContentToRemove.push(e)}};_.prototype.addContent=function(e,t){this.addAggregation("content",e,t);if(t!==true){this.invalidate()}return this};_.prototype.removeContent=function(e,t){var n=this.removeAggregation("content",e,t);if(!t){var r;if(n&&n.getDomRef){r=n.getDomRef()}this._addRemovedContent(r)}return n};_.prototype.removeAllContent=function(){var e=this.removeAllAggregation("content");for(var t=0;t<e.length;t++){var n;var r=e[t];if(r&&r.getDomRef){n=r.getDomRef()}this._addRemovedContent(n)}return e};_.prototype.destroyContent=function(){var e=this.getContent();for(var t=0;t<e.length;t++){var n;var r=e[t];if(r&&r.getDomRef){n=r.getDomRef()}this._addRemovedContent(n)}this.destroyAggregation("content");return this};_.prototype.lock=function(){this.bLocked=true};_.prototype.unlock=function(){if(this.bLocked&&this.bNeedsRerendering){c.invalidateUIArea(this)}this.bLocked=false};_.prototype.isLocked=function(){return this.bLocked};_.prototype.getBindingContext=function(){return null};_.prototype.getEventingParent=function(){return I._getEventProvider()};_.prototype.isActive=function(){return!!this.getId()&&document.getElementById(this.getId())!=null};_.prototype.invalidate=function(){this.addInvalidatedControl(this)};_.prototype.addInvalidatedControl=function(e){if(this.bRenderSelf){return}if(!this.bNeedsRerendering){c.invalidateUIArea(this)}var t=e.getId();if(e===this){this.bRenderSelf=true;this.bNeedsRerendering=true;this.mInvalidatedControls={};this.mInvalidatedControls[t]=E(this);return}if(this.mInvalidatedControls[t]){return}if(!this.bRenderSelf){this.mInvalidatedControls[t]=E(e);this.bNeedsRerendering=true}};_.prototype.rerender=function(e){var t=this;function n(){t.bRenderSelf=false;t.aContentToRemove=[];t.mInvalidatedControls={};t.bNeedsRerendering=false}if(e){this.bNeedsRerendering=true}if(this.bLocked||!this.bNeedsRerendering){return false}var a=this.bRenderSelf,s=this.aContentToRemove,d=this.mInvalidatedControls,l=false;n();f.pause("renderPendingUIUpdates");f.start(this.getId()+"---rerender","Rerendering of "+this.getMetadata().getName());N(this,d);if(a){if(this.oRootNode){R.debug("Full Rendering of UIArea '"+this.getId()+"'");o.preserveContent(this.oRootNode,false,this.bInitial);this.bInitial=false;var p=function(e,n){var r=e.length;var i;for(var a=0;a<r;a++){i=n?e[a].getDomRef():e[a];if(i&&!o.isPreservedContent(i)&&t.oRootNode===i.parentNode){jQuery(i).remove()}}return r};var g=document.activeElement;var c=i.getControlFocusInfo();p(s);var h=this.getContent();var v=p(h,true);var y=document.activeElement;for(var m=0;m<v;m++){if(h[m]&&h[m].getParent()===this){C.render(h[m],this.oRootNode,true)}}l=true;if(g&&g!=y&&y===document.activeElement){try{i.restoreFocus(c)}catch(e){u.warning("Problems while restoring the focus after full UIArea rendering: "+e,null,this)}}}else{R.debug("Full Rendering of UIArea '"+this.getId()+"' postponed, no root node")}}else{var b=function(e){for(;;){if(e.getMetadata&&e.getMetadata().isInstanceOf("sap.ui.core.PopupInterface")){break}e=e.getParent();if(!e||e===t){return false}if(d.hasOwnProperty(e.getId())){return true}}};for(var I in d){var A=r.registry.get(I);if(A&&!b(A)){A.rerender();l=true}}}k(d,this.mInvalidatedControls);f.end(this.getId()+"---rerender");f.resume("renderPendingUIUpdates");return l};_.prototype._onControlRendered=function(e){var t=e.getId();if(this.mInvalidatedControls[t]){delete this.mInvalidatedControls[t]}};_.rerenderControl=function(e){var t=null;if(e){t=e.getDomRef();if(!t||o.isPreservedContent(t)){t=document.getElementById(o.RenderPrefixes.Invisible+e.getId())}}var n=t&&t.parentNode;if(n){var r=e.getUIArea();var i=r?C:new o;R.debug("Rerender Control '"+e.getId()+"'"+(r?"":" (using a temp. RenderManager)"));o.preserveContent(t,true,false,e);i.render(e,n)}else{var r=e.getUIArea();r&&r._onControlRendered(e);R.warning("Couldn't rerender '"+e.getId()+"', as its DOM location couldn't be determined")}};var D=/^(mousedown|mouseup|click|keydown|keyup|keypress|touchstart|touchend|tap)$/;var F=[],w=[];var G={mousemove:1,mouseover:1,mouseout:1,scroll:1,dragover:1,dragenter:1,dragleave:1};_.addEventPreprocessor=function(e){F.push(e)};_.getEventPreprocessors=function(){return F};_.addEventPostprocessor=function(e){w.push(e)};_.getEventPostprocessors=function(){return w};_.configureEventLogging=function(e){Object.assign(G,e);return Object.assign({},G)};_.prototype._handleEvent=function(e){var t,n,o;t=n=r.closestTo(e.target);s.refresh();if(t==null){return}if(e.isMarked("delayedMouseEvent")){return}var i=e.getMark("handledByUIArea"),d=this.getId();if(i&&i!==d){e.setMark("firstUIArea",false);return}e.setMarked("firstUIArea");e.srcControl=t;if(e.type==="contextmenu"&&e.shiftKey&&e.altKey&&(e.metaKey||e.ctrlKey)){u.info("Suppressed forwarding the contextmenu event as control event because CTRL+SHIFT+ALT is pressed!");return}F.forEach(function(t){t(e)});I._handleControlEvent(e,d);if(this.bLocked||I.isLocked()){return}if(a.getActive()){o=e.type.match(D);if(o){a.notifyEventStart(e)}}var l=[];if(e.getPseudoTypes){l=e.getPseudoTypes()}l.push(e.type);var f=false;while(n instanceof r&&n.isActive()&&!e.isPropagationStopped()){var p=e.getMark("scopeCheckId"),g=p&&window.document.getElementById(p),c=n.getDomRef();if(!g||c&&c.contains(g)){for(var h=0,v=l.length;h<v;h++){var y=l[h];e.type=y;e.currentTarget=n.getDomRef();n._handleEvent(e);if(e.isImmediatePropagationStopped()){break}}if(!f&&!e.isMarked("enterKeyConsumedAsContent")){f=this._handleGroupChange(e,n)}if(e.isPropagationStopped()){break}if(n.bStopEventBubbling){break}c=n.getDomRef();if(!c){break}}c=c.parentNode;n=null;if(e.isMarked("fromMouseout")&&(c&&c.contains(e.relatedTarget))){break}while(c&&c!==this.getRootNode()){if(c.id){n=r.closestTo(c);if(n){break}}c=c.parentNode}}w.forEach(function(t){t(e)});if(o){a.notifyEventEnd(e)}e.currentTarget=this.getRootNode();e.setMark("handledByUIArea",d);if(e.isPropagationStopped()){u.debug("'"+e.type+"' propagation has been stopped")}var m=e.type;if(!G[m]){if(t){u.debug("Event fired: '"+m+"' on "+t,"","sap.ui.core.UIArea")}else{u.debug("Event fired: '"+m+"'","","sap.ui.core.UIArea")}}};_.prototype._onattach=function(){var e=this.getRootNode();if(e==null){return}jQuery(e).attr("data-sap-ui-area",e.id).on(v.events.join(" "),this._handleEvent.bind(this))};_.prototype._ondetach=function(){var e=this.getRootNode();if(e==null){return}jQuery(e).removeAttr("data-sap-ui-area").off()};_.prototype.clone=function(){throw new Error("UIArea can't be cloned")};_.prototype._handleGroupChange=function(e,t){var n=_._oFieldGroupValidationKey;if(e.type==="focusin"||e.type==="focusout"){if(e.type==="focusout"){t=r.closestTo(document.activeElement)}if(_._iFieldGroupDelayTimer){clearTimeout(_._iFieldGroupDelayTimer);_._iFieldGroupDelayTimer=null}_._iFieldGroupDelayTimer=setTimeout(this.setFieldGroupControl.bind(this,t),0);return true}else if(this.getFieldGroupControl()&&e.type==="keyup"&&e.keyCode===n.keyCode&&e.shiftKey===n.shiftKey&&e.altKey===n.altKey&&e.ctrlKey===n.ctrlKey){if(_._iFieldGroupTriggerDelay){clearTimeout(_._iFieldGroupTriggerDelay)}var o=this.getFieldGroupControl(),i=o?o._getFieldGroupIds():[];if(i.length>0){o.triggerValidateFieldGroup(i)}return true}return false};_.prototype.setFieldGroupControl=function(e){var t=e;while(t&&!(t instanceof r&&t.isA("sap.ui.core.Control"))){t=t.getParent()}var n=this.getFieldGroupControl();if(t!=n&&document.activeElement&&document.activeElement.id!=="sap-ui-static-firstfe"){var o=n?n._getFieldGroupIds():[],i=t?t._getFieldGroupIds():[],a=o.filter(function(e){return i.indexOf(e)<0});if(a.length>0){n.triggerValidateFieldGroup(a)}_._oFieldGroupControl=t}return this};_.prototype.getFieldGroupControl=function(){if(_._oFieldGroupControl&&!_._oFieldGroupControl.bIsDestroyed){return _._oFieldGroupControl}return null};t.apply(_,{onDuplicate:function(e,t,n){var r="adding UIArea with duplicate id '"+e+"'";u.error(r);throw new Error("Error: "+r)}});_._oFieldGroupControl=null;_._iFieldGroupDelayTimer=null;_._oFieldGroupValidationKey={keyCode:d.ENTER,shiftKey:false,altKey:false,ctrlKey:false};_._oRenderLog=R;_.create=function(e){l(typeof e==="string"||typeof e==="object","oDomRef must be a string or object");if(!e){throw new Error("oDomRef must not be null")}if(typeof e==="string"){var t=e;if(t==b){e=_.getStaticAreaRef()}else{e=document.getElementById(e);if(!e){throw new Error("DOM element with ID '"+t+"' not found in page, but application tries to insert content.")}}}if(!e.id||e.id.length==0){e.id=p()}var n=e.id;var r=_.registry.get(n);if(!r){r=new _(e);if(!g(I.oModels)){var o={oModels:Object.assign({},I.oModels),oBindingContexts:{},aPropagationListeners:[]};r._propagateProperties(true,r,o,true)}}else{r._setRootNode(e)}return r};_.getStaticAreaRef=function(){if(!A){throw new Error("DOM is not ready yet. Static UIArea cannot be created.")}var e=document.getElementById(b),t;if(!e){e=document.createElement("div");t=document.createElement("span");e.setAttribute("id",b);Object.assign(e.style,{height:"0",width:"0",overflow:"hidden",float:n.getRTL()?"right":"left"});t.setAttribute("id",b+"-firstfe");t.setAttribute("tabindex",-1);t.style.fontSize=0;e.appendChild(t);document.body.insertBefore(e,document.body.firstChild);_.create(e).bInitial=false}return e};_.isStaticAreaRef=function(e){return!!(e&&e.id===b)};_.setCore=function(e){I=e;var t=n.getValue("areas");if(t){for(var r=0,o=t.length;r<o;r++){_.create(t[r])}}};return _});
//# sourceMappingURL=UIArea.js.map