/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["jquery.sap.global","sap/ui/support/library","sap/ui/core/mvc/XMLView","sap/ui/core/Configuration"],function(e,t,a,o){"use strict";var i=t.Categories;var n=t.Severity;var s=t.Audiences;var r={id:"preloadAsyncCheck",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.58",title:"Preload Configuration",description:"Checks whether the preload configuration was set correctly to async",resolution:"Please execute this rule to get a specific solution based on the application's preload mode configuration.",resolutionurls:[{text:"Performance: Speed Up Your App",href:"https://sdk.openui5.org/topic/408b40efed3c416681e1bd8cdd8910d4"},{text:"Best Practices for Loading Modules Asynchronously",href:"https://sdk.openui5.org/topic/00737d6c1b864dc3ab72ef56611491c4"},{text:"Is Your Application Ready for Asynchronous Loading?",href:"https://sdk.openui5.org/topic/493a15aa978d4fe9a67ea9407166eb01"}]};r.check=function(e,t){var a=o.getDebug();if(a){return}var i=sap.ui.getCore().getLoadedLibraries()["sap.ushell"];if(i){return}var s=o.getPreload(),c=sap.ui.loader.config().async;var d="It is recommended to use the configuration option "+"'data-sap-ui-async=\"true\"' instead of 'data-sap-ui-preload=\"async\"'. "+"With this option single modules and preload files will be loaded asynchronously. "+"Note: Enabling this behaviour requires intensive testing of the application.";if(s==="async"&&!c){r.resolution="Please replace 'data-sap-ui-preload=\"async\"' with 'data-sap-ui-async=\"true\"' "+"in the bootstrap script, as it implicitly sets the loading behaviour of preload files to be asynchronous.";e.addIssue({severity:n.High,details:d,context:{id:"WEBPAGE"}})}else if(s!=="async"&&!c){r.resolution="Please configure 'data-sap-ui-async=\"true\"' in the bootstrap script, "+"as it implicitly sets the loading behaviour of preload files to be asynchronous. "+"In case you have already configured the 'data-sap-ui-preload' option, you should remove it.";e.addIssue({severity:n.High,details:d,context:{id:"WEBPAGE"}})}};var c={id:"cacheBusterToken",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.28",title:"Application Resource Caching",description:"Checks whether the application uses cache buster tokens in its requests for static resources from SAPUI5 repositories",resolution:"Change the application\n"+"Note: Not using cache buster tokens has a negative impact on performance.\n"+"For more information, see the SAPUI5 developer guide.",resolutionurls:[{text:"Documentation: Cache Buster for SAPUI5 Application Resources",href:"https://sdk.openui5.org/topic/4cfe7eff3001447a9d4b0abeaba95166"}],check:function(t,a,o){var i="/sap/bc/ui5_ui5/";var s=[];var r;var c=e.sap.measure.getRequestTimings();for(var d=0;d<c.length;d++){var u=c[d].name;if(u.indexOf(i)>0){if(!u.match(/\/~[A-Z0-9]*~/g)){if(u.indexOf("/sap-ui-cachebuster/sap-ui-core.js")<0&&u.indexOf("sap-ui-cachebuster-info.json")<0){var l=u.split(i);l=l[1].split("/");r=l[0]==="sap"?l[1]:"/"+l[0]+"/"+l[1];if(s.indexOf(r)<0){s.push(r)}}}}}for(var d=0;d<s.length;d++){r=s[d];var p=i+(r.charAt(0)==="/"?r.substr(1):"sap/"+r);t.addIssue({severity:n.Medium,details:"Application '"+r+"' has no cache buster tokens in some or all of its requests.\n "+"For more information about the URLs affected under application '"+r+"' please check the network trace for URLs starting with '"+p+"'",context:{id:"WEBPAGE"}})}}};var d={id:"libraryUsage",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.34",title:"Library Usage",description:"Checks whether there are unused loaded libraries. This rule only works on global execution scope.",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Descriptor Dependencies to Libraries and Components",href:"https://sdk.openui5.org/topic/8521ad1955f340f9a6207d615c88d7fd"}],check:function(t,a,o){if(o.getType()==="global"){var i=sap.ui.getCore().getLoadedLibraries();o.getElements().forEach(function(e){var t=e.getMetadata().getLibraryName();if(i[t]){delete i[t]}});var s=sap.ui.require("sap/base/util/LoaderExtensions");var r;if(s){r=s.getAllRequiredModules()}else{r=e.sap.getAllDeclaredModules()}Object.keys(i).forEach(function(e){var t=e+".";for(var a=0;a<r.length;a++){var o=r[a];if(o.indexOf(t)===0&&i[e].types.indexOf(o)===-1&&o.lastIndexOf(".library")!==o.length-".library".length&&o.lastIndexOf(".library-preload")!==o.length-".library-preload".length&&o.lastIndexOf(".flexibility")!==o.length-".flexibility".length&&o.lastIndexOf(".support")!==o.length-".support".length){delete i[e];break}}});var c=Object.keys(i);Object.keys(i).forEach(function(e){i[e].dependencies.forEach(function(e){var t=c.indexOf(e);if(t>-1){c.splice(t,1)}})});c.forEach(function(e){if(e){t.addIssue({severity:n.Medium,details:"The library '"+e+"' has been loaded, but not used so far in the analyzed scope of the application. There are two options to solve this issue: \n"+"1. If the library is needed at later state in your application, you can make use of lazy library loading (see resolution section)."+" Please be aware that if this lazy flag isn't used correctly this might lead to a performance decrease. \n"+"2. If the library has been loaded by accident and is never used in the application, you should remove the library from the bootstrap or application descriptor.",context:{id:"WEBPAGE"}})}})}}};var u={id:"lazyComponents",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.48",title:"Lazy loading of components",description:"Checks whether lazy loading of components is used",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Descriptor Dependencies to Libraries and Components",href:"https://sdk.openui5.org/topic/8521ad1955f340f9a6207d615c88d7fd"}],check:function(e,t,a){var o=t.getComponents();var i={};var s=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();if(t&&t["sap.ui5"]&&t["sap.ui5"].dependencies){var a=t["sap.ui5"].dependencies.components;if(a&&Object.keys(a).length>0){i[e]=true;Object.keys(a).forEach(function(e){if(a[e].lazy!==undefined){s=true}})}}});if(Object.keys(i).length>0&&!s){Object.keys(i).forEach(function(t){e.addIssue({severity:n.Medium,details:"No lazy Component loading detected. Define lazy components in your application descriptor, if this feature can be used in the application.",context:{id:t}})})}}};var l={id:"reuseComponents",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.48",title:"Components reusage via componentUsages",description:"Components are more performant and flexible, if defined via componentUsages",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Using and Nesting Components",href:"https://sdk.openui5.org/topic/346599f0890d4dfaaa11c6b4ffa96312"}],check:function(e,t,a){var o=t.getComponents();var i={};var s=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();var a=t["sap.ui5"];if(a&&a.dependencies&&a.dependencies["components"]&&Object.keys(a.dependencies["components"]).length>0){i[e]=true}if(a&&a.componentUsages!==undefined){s=true}});if(Object.keys(i).length>0&&!s){Object.keys(i).forEach(function(t){e.addIssue({severity:n.Medium,details:"There are defined reuse components in the application descriptor. Please check the documentation,"+" whether you can define your components via componentUsage.",context:{id:t}})})}}};var p={id:"modelPreloading",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.38",title:"Model preloading",description:"Preloaded models, which load their data from external locations, can load data earlier",resolution:"Adapt your application descriptor and your application coding to improve the performance",resolutionurls:[{text:"Documentation: Manifest Model Preload",href:"https://sdk.openui5.org/topic/26ba6a5c1e5c417f8b21cce1411dba2c"}],check:function(e,t,a){var o=t.getComponents();var i={};var s=false;Object.keys(o).forEach(function(e){var t=o[e].getManifest();var a=t["sap.ui5"].models||{};var n=t["sap.app"].dataSources;Object.keys(a).forEach(function(t){var o=a[t];var r;if(o.dataSource){r=n[o.dataSource]}if(o.type==="sap.ui.model.odata.v2.ODataModel"||o.type==="sap.ui.model.odata.v4.ODataModel"||r&&r.type==="OData"){i[e]=true;if(o.preload!==undefined){s=true}}})});if(!s){Object.keys(i).forEach(function(t){e.addIssue({severity:n.High,details:"The used OData models don't make use of the preloading feature.",context:{id:t}})})}}};var f={id:"modelPreloadAndEarlyRequests",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.53",title:"OData V4 model preloading and no earlyRequests",description:"Manifest model preload is useless if V4 ODataModel earlyRequests is false",resolution:"Set manifest parameter models[<Model Name>].settings.earlyRequests to true",resolutionurls:[{text:"Documentation: Manifest Model Preload",href:"https://sdk.openui5.org/topic/26ba6a5c1e5c417f8b21cce1411dba2c"},{text:"API: V4 ODataModel, parameter earlyRequests",href:"https://sdk.openui5.org/api/sap.ui.model.odata.v4.ODataModel"}],check:function(e,t,a){var o=t.getComponents();Object.keys(o).forEach(function(t){var a=o[t].getManifest(),i=a["sap.app"].dataSources,s=a["sap.ui5"].models||{};Object.keys(s).forEach(function(a){var o,r=s[a];if(r.dataSource){o=i[r.dataSource]}if(r.type==="sap.ui.model.odata.v4.ODataModel"||o&&o.type==="OData"&&o.settings&&o.settings.odataVersion==="4.0"){if(r.preload===true&&!(r.settings&&r.settings.earlyRequests===true)){e.addIssue({severity:n.High,details:"Set sap.ui5.models['"+a+"'].settings"+".earlyRequests in manifest to true",context:{id:t}})}}})})}};var h={id:"asynchronousXMLViews",audiences:[s.Application],categories:[i.Performance],enabled:true,minversion:"1.34",title:"Asynchronous XML views",description:"Asynchronous XML views leads to smoother view transitions, doesn't block the UI and allows for more efficient SAPUI5 flexibility services",resolution:"Adapt your application descriptor and your application coding to improve the performance and efficiency",resolutionurls:[{text:"Documentation: Routing Configuration",href:"https://sdk.openui5.org/topic/902313063d6f45aeaa3388cc4c13c34e"},{text:"Documentation: Instantiating Views",href:"https://sdk.openui5.org/topic/68d0e58857a647d49470d9f92dd859bd"},{text:"Documentation: UI Adaptation at Runtime: Enable Your App",href:"https://sdk.openui5.org/topic/f1430c0337534d469da3a56307ff76af"}],check:function(e,t,o){var i=t.getComponents();var s={};var r=o.getElementsByClassName(a).filter(function(e){return e.oAsyncState===undefined&&!e.isSubView()});Object.keys(i).forEach(function(e){var t=i[e].getRouter&&i[e].getRouter();if(t&&t._oConfig){if(t._oConfig._async!==true){s[e]=[];if(i[e].getTargets()&&i[e].getTargets()._oViews&&i[e].getTargets()._oViews._oViews){var a=i[e].getTargets()._oViews._oViews;Object.keys(a).forEach(function(t){var o=a[t].getViewName().split(".").pop();s[e].push(o);r=r.filter(function(e){return a[t]!==e})})}}}});Object.keys(s).forEach(function(t){e.addIssue({severity:n.High,details:"Routing between views ("+s[t].join(", ")+") is used, but configured to be synchronous."+" Please take a look at the resolution 'Routing Configuration'.",context:{id:t}})});r.forEach(function(t){var a=t.getId();var o=t.getViewName().split(".").pop();e.addIssue({severity:n.Medium,details:"The XML view '"+o+" is loaded synchronous. Please take a look at the resolution 'Instantiating Views'.",context:{id:a}})})}};return[r,c,d,u,l,p,f,h]},true);