/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/support/Plugin","sap/ui/core/format/DateFormat","sap/base/Log","sap/base/security/encodeXML"],function(e,t,o,n){"use strict";var r=e.extend("sap.ui.core.support.plugins.Trace",{constructor:function(n){e.apply(this,["sapUiSupportTrace","JavaScript Trace",n]);this._aEventIds=this.runsAsToolPlugin()?[this.getId()+"Entry"]:[];if(this.runsAsToolPlugin()){this._aLogEntries=[];this._iLogLevel=o.Level.ALL;this._oDateFormat=t.getDateTimeInstance()}else{var r=this;this._oldLogLevel=o.getLevel();o.setLevel(o.Level.ALL);o.addLogListener({onLogEntry:function(e){if(r.isActive()){n.sendEvent(r.getId()+"Entry",{entry:e})}}})}}});r.prototype.onsapUiSupportTraceEntry=function(e){l(this,e.getParameter("entry"))};r.prototype.init=function(t){e.prototype.init.apply(this,arguments);if(!this.runsAsToolPlugin()){return}var o=this;var n=sap.ui.getCore().createRenderManager();n.openStart("div").class("sapUiSupportToolbar").openEnd();n.openStart("button",this.getId()+"-clear").class("sapUiSupportRoundedButton").openEnd().text("Clear").close("button");n.openStart("label").class("sapUiSupportLabel").openEnd().text("Filter:").close("label");n.voidStart("input",this.getId()+"-filter").class("sapUiSupportTxtFld").attr("type","text").voidEnd();n.openStart("label").class("sapUiSupportLabel").openEnd().text("Log Level:").close("label");n.openStart("select",this.getId()+"-loglevel").class("sapUiSupportTxtFld").class("sapUiSupportSelect").openEnd();n.openStart("option").attr("value","0").openEnd().text("FATAL").close("option");n.openStart("option").attr("value","1").openEnd().text("ERROR").close("option");n.openStart("option").attr("value","2").openEnd().text("WARNING").close("option");n.openStart("option").attr("value","3").openEnd().text("INFO").close("option");n.openStart("option").attr("value","4").openEnd().text("DEBUG").close("option");n.openStart("option").attr("value","5").openEnd().text("TRACE").close("option");n.openStart("option").attr("value","6").attr("selected","").openEnd().text("ALL").close("option");n.close("select");n.close("div");n.openStart("div").class("sapUiSupportTraceCntnt").openEnd().close("div");n.flush(this.$().get(0));n.destroy();this._fClearHandler=function(){l(o)};this._fLogLevelHandler=function(){o._iLogLevel=o.$("loglevel").val();var e=[];for(var t=0;t<o._aLogEntries.length;t++){if(i(o._filter,o._iLogLevel,o._aLogEntries[t])){e.push(a(o,o._aLogEntries[t]))}}l(o,e.join(""))};this._fFilterHandler=function(){o._filter=o.$("filter").val();o._filter=o._filter?o._filter.toLowerCase():"";var e=[];for(var t=0;t<o._aLogEntries.length;t++){if(i(o._filter,o._iLogLevel,o._aLogEntries[t])){e.push(a(o,o._aLogEntries[t]))}}l(o,e.join(""))};this.$("clear").on("click",this._fClearHandler);this.$("filter").on("change",this._fFilterHandler);this.$("loglevel").on("change",this._fLogLevelHandler)};r.prototype.exit=function(t){if(this.runsAsToolPlugin()){if(this._fClearHandler){this.$("clear").off("click",this._fClearHandler);this._fClearHandler=null}if(this._fFilterHandler){this.$("filter").off("change",this._fFilterHandler);this._fFilterHandler=null}if(this._fLogLevelHandler){this.$("loglevel").off("change",this._fLogLevelHandler);this._fLogLevelHandler=null}}else{o.setLevel(this._oldLogLevel);this._oldLogLevel=null}e.prototype.exit.apply(this,arguments)};function l(e,t){var o=e.$()[0].querySelector(".sapUiSupportTraceCntnt");if(!t){o.textContent="";e._aLogEntries=[]}else if(typeof t==="string"){o.textContent=n(t);o.scrollTop=o.scrollHeight}else{t._levelInfo=s(t.level);if(i(e._filter,e._iLogLevel,t)){o.insertAdjacentHTML("beforeend",a(e,t));o.scrollTop=o.scrollHeight}e._aLogEntries.push(t)}}function a(e,t){var o=t._levelInfo;var r="<div class='sapUiSupportTraceEntry'><span class='sapUiSupportTraceEntryLevel sapUiSupportTraceEntryLevel_"+o[0]+"'>"+o[0]+"</span><span class='sapUiSupportTraceEntryTime'>"+e._oDateFormat.format(new Date(t.timestamp))+"</span><span class='sapUiSupportTraceEntryMessage'>"+n(t.message||"")+"</div>";return r}function i(e,t,o){var n=o._levelInfo;if(o._levelInfo[1]<=t){if(e){var r=e.split(" ");var l=true;for(var a=0;a<r.length;a++){l=l&&o.message.toLowerCase().indexOf(r[a])>=0||n[0].toLowerCase().indexOf(r[a])>=0}return l}return true}return false}function s(e){switch(e){case o.Level.FATAL:return["FATAL",e];case o.Level.ERROR:return["ERROR",e];case o.Level.WARNING:return["WARNING",e];case o.Level.INFO:return["INFO",e];case o.Level.DEBUG:return["DEBUG",e];case o.Level.TRACE:return["TRACE",e];default:return["unknown",e]}}return r});