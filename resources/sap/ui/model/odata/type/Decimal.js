/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/ui/core/format/NumberFormat","sap/ui/model/FormatException","sap/ui/model/ParseException","sap/ui/model/ValidateException","sap/ui/model/odata/ODataUtils","sap/ui/model/odata/type/ODataType"],function(t,e,n,i,r,a,o){"use strict";var s=/^[-+]?(\d+)(?:\.(\d+))?$/,u=/(?:(\.[0-9]*[1-9]+)0+|\.0*)$/;function l(t){var n,i,r;if(!t.oFormat){n={groupingEnabled:true,maxIntegerDigits:Infinity};i=m(t);if(i!==Infinity){n.minFractionDigits=n.maxFractionDigits=i}r=t.oFormatOptions||{};if(r.style!=="short"&&r.style!=="long"){n.preserveDecimals=true}Object.assign(n,t.oFormatOptions);n.parseAsString=true;t.oFormat=e.getFloatInstance(n)}return t.oFormat}function m(t){return t.oConstraints&&t.oConstraints.scale||0}function f(t,e){return sap.ui.getCore().getLibraryResourceBundle().getText(t,e)}function c(t){if(t.indexOf(".")>=0){t=t.replace(u,"$1")}return t}function p(e,n){var i,r,a,o,u;function l(n,i){t.warning("Illegal "+i+": "+n,null,e.getName())}function m(t,e,n,i){var r=typeof t==="string"?parseInt(t):t;if(r===undefined){return e}if(typeof r!=="number"||isNaN(r)||r<n){l(t,i);return e}return r}function f(t,e){if(t){if(t.match(s)){return t}l(t,e)}return undefined}function c(t,e){if(t===true||t==="true"){return true}if(t!==undefined&&t!==false&&t!=="false"){l(t,e)}return undefined}function p(t,n,i){if(n!==i){e.oConstraints=e.oConstraints||{};e.oConstraints[t]=n}}e.oConstraints=undefined;if(n){i=n.nullable;a=n.precision;u=n.scale;o=u==="variable"?Infinity:m(u,0,0,"scale");r=m(a,Infinity,1,"precision");if(o!==Infinity&&r<o){t.warning("Illegal scale: must be less than or equal to precision (precision="+a+", scale="+u+")",null,e.getName());o=Infinity}p("precision",r,Infinity);p("scale",o,0);if(i===false||i==="false"){p("nullable",false,true)}else if(i!==undefined&&i!==true&&i!=="true"){l(i,"nullable")}p("minimum",f(n.minimum,"minimum"));p("minimumExclusive",c(n.minimumExclusive,"minimumExclusive"));p("maximum",f(n.maximum,"maximum"));p("maximumExclusive",c(n.maximumExclusive,"maximumExclusive"))}e._handleLocalizationChange()}var h=o.extend("sap.ui.model.odata.type.Decimal",{constructor:function(t,e){o.apply(this,arguments);this.oFormatOptions=t;p(this,e)}});h.prototype.formatValue=function(t,e){if(t===null||t===undefined){return null}switch(this.getPrimitiveType(e)){case"any":return t;case"float":return parseFloat(t);case"int":return Math.floor(parseFloat(t));case"string":return l(this).format(c(String(t)));default:throw new n("Don't know how to format "+this.getName()+" to "+e)}};h.prototype.parseValue=function(t,n){var r;if(t===null||t===""){return null}switch(this.getPrimitiveType(n)){case"string":r=l(this).parse(t);if(!r){throw new i(sap.ui.getCore().getLibraryResourceBundle().getText("EnterNumber"))}r=c(r);break;case"int":case"float":r=e.getFloatInstance({maxIntegerDigits:Infinity,decimalSeparator:".",groupingEnabled:false}).format(t);break;default:throw new i("Don't know how to parse "+this.getName()+" from "+n)}return r};h.prototype._handleLocalizationChange=function(){this.oFormat=null};h.prototype.validateValue=function(t){var e,n,i,o,u,l,c,p,h;if(t===null&&(!this.oConstraints||this.oConstraints.nullable!==false)){return}if(typeof t!=="string"){throw new r(f("EnterNumber"))}i=s.exec(t);if(!i){throw new r(f("EnterNumber"))}n=i[1].length;e=(i[2]||"").length;h=m(this);p=this.oConstraints&&this.oConstraints.precision||Infinity;l=this.oConstraints&&this.oConstraints.minimum;o=this.oConstraints&&this.oConstraints.maximum;if(e>h){if(h===0){throw new r(f("EnterInt"))}else if(n+h>p){if(h!==p){throw new r(f("EnterNumberIntegerFraction",[p-h,h]))}if(i[1]!=="0"){throw new r(f("EnterNumberFractionOnly",[h]))}}throw new r(f("EnterNumberFraction",[h]))}if(h===Infinity){if(n+e>p){throw new r(f("EnterNumberPrecision",[p]))}}else if(n>p-h){if(h!==p){if(h){throw new r(f("EnterNumberInteger",[p-h]))}throw new r(f("EnterMaximumOfDigits",[p]))}if(i[1]!=="0"){throw new r(f("EnterNumberFractionOnly",[h]))}}if(l){c=this.oConstraints.minimumExclusive;if(a.compare(l,t,true)>=(c?0:1)){throw new r(f(c?"EnterNumberMinExclusive":"EnterNumberMin",[this.formatValue(l,"string")]))}}if(o){u=this.oConstraints.maximumExclusive;if(a.compare(o,t,true)<=(u?0:-1)){throw new r(f(u?"EnterNumberMaxExclusive":"EnterNumberMax",[this.formatValue(o,"string")]))}}};h.prototype.getName=function(){return"sap.ui.model.odata.type.Decimal"};return h});