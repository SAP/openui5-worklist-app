/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/thirdparty/jquery","sap/ui/core/mvc/Controller","sap/ui/core/mvc/XMLView","sap/ui/model/Filter","sap/ui/model/FilterType","sap/ui/model/json/JSONModel","sap/base/util/UriParameters","sap/base/security/encodeXML"],function(jQuery,t,e,n,r,i,s,a){"use strict";var o=/^((?:[a-z0-9]+\.)+_?[A-Z]\w+)(\.[a-z]\w+)?$/,l="\t\t.blanket-source {\t\t\toverflow-x: scroll;\t\t\tbackground-color: #FFFFFF;\t\t\tborder: 1px solid #CBCBCB;\t\t\tcolor: #363636;\t\t\tmargin: 25px 20px;\t\t\twidth: 80%;\t\t}\t\t.blanket-source div {\t\t\twhite-space: pre;\t\t\ttab-size: 4;\t\t\tfont-family: monospace;\t\t}\t\t.blanket-source > div > span:first-child {\t\t\tbackground-color: #EAEAEA;\t\t\tcolor: #949494;\t\t\tdisplay: inline-block;\t\t\tpadding: 0 10px;\t\t\ttext-align: center;\t\t\twidth: 30px;\t\t}\t\t.blanket-source .hits {\t\t\tbackground-color: #EAEAEA;\t\t\tcolor: green;\t\t\tdisplay: inline-block;\t\t\tpadding: 0 10px;\t\t\ttext-align: right;\t\t\twidth: 30px;\t\t}\t\t.blanket-source span.highlight {\t\t\tcolor: black;\t\t\tbackground-color: yellow\t\t}\t\t.blanket-source .hit {\t\t\tbackground-color: lightgreen\t\t}\t\t.blanket-source .miss {\t\t\tbackground-color: #e6c3c7\t\t}\t\t.blanket-source .skipped {\t\t\tfont-style: italic\t\t}\t\t.blanket-source .miss span.highlight {\t\t\tbackground-color: #e6c3c7\t\t}\t\t.coverageSummary {\t\t\tbackground-color: #0D3349;\t\t\tborder-radius: 0 0 5px 5px;\t\t\tfont-family: Calibri, Helvetica, Arial, sans-serif;\t\t\tfont-size: 1.5em;\t\t\tfont-weight: 400;\t\t\tline-height: 1em;\t\t\tpadding: 0.5em 0 0.5em 1em;\t\t}\t\t.coverageSummary a {\t\t\tcolor: #C6E746;\t\t}\t\t.coverageSummary a:hover,\t\t.coverageSummary a:focus {\t\t\tcolor: #FFFFFF;\t\t}\t";t.extend("sap.ui.test.BlanketReporterUI",{filterThreshold:function(t){var e,i=null,s=this.byId("Files"),a=this.getView().getModel().getProperty("/threshold");if(t){i=new n({filters:[new n("lines/coverage","LT",a),new n("branches/coverage","LT",a)],and:false})}e=s.getBinding("rows");e.filter(i,r.Application)},onBeforeRendering:function(){this.filterThreshold(this.getView().getModel().getProperty("/filterThreshold"))},onFilterThreshold:function(t){this.filterThreshold(t.getParameter("selected"))},onRowSelection:function(){var t,e,n=this.byId("blanket-source"),r,i=this.getView().getModel(),s,a=this.byId("Files"),o=a.getSelectedIndex()-a.getFirstVisibleRow();if(o>=0){t=a.getRows()[o].getBindingContext();e=t.getObject("name");r=i.getProperty("/linesOfContext");s=i.getObject("/coverageData").files[e];n.setContent('<div class="blanket-source">'+u(s,r,i.getProperty("/showHits"))+"</div>");n.setVisible(true)}else{n.setContent("<div></div>")}}});function c(t,e,n,r,i){var s=0,o=-Infinity,l=n.reduce(g,[]).sort(u),c=0;function u(t,e){return t.line-e.line||t.column-e.column}function d(){var t="";if(c>0){t="<div class='ellipsis'><span>...</span>";if(i){t+="<span class='hits'>&nbsp;</span>"}t+="<span class='skipped'>"+c+" lines skipped</span></div>";c=0}return t}function f(t,e){e=a(e);if(e&&s){o=t;e="<span class='highlight'>"+e+"</span>"}return e}function h(t,e){var n=0,r="";while(l.length&&t===l[0].line){r+=f(t,e.slice(n,l[0].column));n=l[0].column;s+=l.shift().delta}r+=f(t,e.slice(n));return r}function g(t,e){e.start.delta=+1;t.push(e.start);e.end.delta=-1;t.push(e.end);return t}if(r===undefined){r=Infinity}return t.reduce(function(t,n,s){var a,u=l.length&&l[0].line||Infinity,f;function g(){t+="<div";if(e[s]===0){t+=" class='miss'";o=s}else if(i&&e[s]>0){t+=" class='hit'"}t+="><span>"+s+"</span>";if(i){t+="<span class='hits'>"+(e[s]>=0?e[s]+"x":"&nbsp;")+"</span>"}t+=h(s,n)+"</div>"}if(i){for(a=s;a<e.length;a+=1){if(e[a]!==undefined){f=a;break}}}else{f=e.indexOf(0,s)}if(f>=0&&f<u){u=f}if(s>=u-r||s<=o+r||u-o===2*(r+1)){t+=d();g()}else{c+=1}return t},"")+d()}function u(t,e,n){var r=t.branchTracking?t.branchTracking.reduce(i,[]):[];function i(t,e){if(!e.falsy){t.push(e.alternate)}if(!e.truthy){t.push(e.consequent)}return t}return c(t.source,t,r,n?Infinity:e,n)}function d(t,e){return e?(e-t)/e*100:100}function f(t){t.lines.coverage=d(t.lines.missed,t.lines.total);t.branches.coverage=d(t.branches.missed,t.branches.total)}function h(t,e,n,r){var s={},a={files:[],lines:{total:0,missed:0,coverage:100},branches:{total:0,missed:0,coverage:100},coverageData:t,filterThreshold:!!n,branchTracking:false,showHits:false};function o(e){var n=t.files[e],r={name:e,lines:{total:0,missed:0,coverage:100},branches:{total:0,missed:0,coverage:100}},i;if(e in s){return}s[e]=true;for(i=0;i<n.length;i++){if(n[i]!==undefined){r.lines.total++;if(n[i]===0){r.lines.missed++}}}if(n.branchTracking){a.branchTracking=true;r.branches.total=n.branchTracking.length;for(i=0;i<n.branchTracking.length;i++){if(!n.branchTracking[i].falsy||!n.branchTracking[i].truthy){r.branches.missed++}}}f(r);a.files.push(r);a.lines.total+=r.lines.total;a.lines.missed+=r.lines.missed;a.branches.total+=r.branches.total;a.branches.missed+=r.branches.missed}if(r&&r.every(function(e){return e in t.files})){a.filterThreshold=false}else{r=Object.keys(t.files)}r.sort().forEach(o);a.linesOfContext=e;a.threshold=n;a.visible=Math.min(Math.max(a.files.length,3),10);f(a);return new i(a)}function g(t,n){e.create({viewName:"sap.ui.test.BlanketReporterUI",models:t}).then(function(t){t.placeAt(n)})}function p(t){var e=o.exec(t);return!e||e[2]===".integration"?undefined:jQuery.sap.getResourceName(e[1])}function b(){var t=document.createElement("div"),e=document.createElement("style");t.setAttribute("id","blanket-view");t.setAttribute("class","sapUiBody");document.body.appendChild(t);e.innerHTML=l;document.head.appendChild(e);return t}return function(t,e,n,r){var i,a,l,c=s.fromQuery(window.location.search);function u(t){var e=o.exec(t);return e&&!e[2]}if(!document.getElementById("blanket-view")){l=n();a=h(r,t,e,l&&l.map(p));i=b();if(r.stats.failures||c.get("filter")||c.get("testId")||l&&!l.every(u)){g(a,i);return}if(a.getProperty("/lines/coverage")<e){g(a,i);throw new Error("Line coverage too low! "+a.getProperty("/lines/coverage")+" < "+e)}if(a.getProperty("/branches/coverage")<e){g(a,i);throw new Error("Branch coverage too low! "+a.getProperty("/branches/coverage")+" < "+e)}i.setAttribute("class","coverageSummary");i.innerHTML='<a href="" id="coverage">Blanket Code Coverage: OK</a>';jQuery("#coverage").one("click",function(t){t.preventDefault();jQuery(i).fadeOut(function(){g(a,b())})})}}});
//# sourceMappingURL=BlanketReporter.js.map