/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/base/Log","sap/base/util/merge","sap/base/util/UriParameters","sap/ui/base/SyncPromise","sap/ui/thirdparty/jquery","sap/ui/core/Core"],function(e,t,r,n,s){"use strict";var i=/\/\$batch($|\?)/,a=/(?:^|\r\n)Content-Id\s*:\s*(\S+)/i,o=/^(.*)?:\s*(.*)$/,u="application/json;charset=UTF-8;IEEE754Compatible=true",c={},f="\r\nContent-Type: application/http\r\n"+"Content-Transfer-Encoding: binary\r\n",p=/^Content-Type:\s*multipart\/mixed;\s*boundary=/i,l=r.fromQuery(window.location.search),d=l.get("autoRespondAfter"),h=l.get("realOData"),y=/^(\S+) (\S+)$/,g=/^(GET|DELETE|MERGE|PATCH|POST) (\S+) HTTP\/1\.1$/,m={},E=/^(OData-Version|DataServiceVersion)$/,x=h==="true"||h==="direct",v=0,T=null,b=l.get("optimisticBatch"),q=b===null?undefined:b==="true",R=l.get("supportAssistant")==="true",C;if(x){document.title=document.title+" (real OData)"}function w(e,t,r){var n=QUnit.objectType(e),s=QUnit.objectType(t),i;if(n==="string"&&s==="regexp"){if(!t.test(e)){throw new Error(r+": actual value "+e+" does not match expected regular expression "+t)}return}if(n!==s){throw new Error(r+": actual type "+n+" does not match expected type "+s)}if(n==="array"){if(e.length<t.length){throw new Error(r+": array length: "+e.length+" < "+t.length)}}if(n==="array"||n==="object"){for(i in t){w(e[i],t[i],r==="/"?r+i:r+"/"+i)}}else if(e!==t){throw new Error(r+": actual value "+e+" does not match expected value "+t)}}function O(e,t,r,n){try{w(e,t,"/");QUnit.assert.pushResult({result:n,actual:e,expected:t,message:r})}catch(s){QUnit.assert.pushResult({result:!n,actual:e,expected:t,message:(r||"")+" failed because of "+s.message})}}C={awaitRendering:function(){if(sap.ui.getCore().getUIDirty()){return new Promise(function(e){function t(){if(sap.ui.getCore().getUIDirty()){setTimeout(t,1)}else{e()}}t()})}},checkError:function(e,t,r,n){e.strictEqual(t.constructor,r);e.strictEqual(t.message,n);e.strictEqual(t.name,r.name)},checkGetAndRequest:function(e,t,r,s,i,a){var o,u=s.replace("fetch","get"),c=e.mock(Promise),f=new Error("rejected"),p=Promise.reject(f),l=s.replace("fetch","request"),d={},h=n.resolve(p);o=e.mock(t).expects(s).exactly(4);o=o.withExactArgs.apply(o,i);o.returns(n.resolve(d));r.strictEqual(t[u].apply(t,i),d);o.returns(h);c.expects("resolve").withExactArgs(sinon.match.same(h)).returns(p);r.strictEqual(t[l].apply(t,i),p);c.restore();if(a){r.throws(function(){t[u].apply(t,i)},new Error("Result pending"))}else{r.strictEqual(t[u].apply(t,i),undefined,"pending")}return h.catch(function(){if(a){r.throws(function(){t[u].apply(t,i)},f)}else{r.strictEqual(t[u].apply(t,i),undefined,"rejected")}})},deepContains:function(e,t,r){O(e,t,r,true)},notDeepContains:function(e,t,r){O(e,t,r,false)},useFakeServer:function(r,n,l,h,y,m){var x,b;function q(e,t){var r=j(e,t.requestBody),n=k(t);v+=1;if(T){T(t.requestBody)}t.respond(200,s.extend({},n,{"Content-Type":"multipart/mixed;boundary="+r.boundary}),S(r,n))}function R(e){var t={buildResponse:e.buildResponse,code:e.code||200,headers:e.headers||{},ifMatch:e.ifMatch};if(e.source){t.message=U(n+e.source);t.headers["Content-Type"]=t.headers["Content-Type"]||w(e.source)}else if(typeof e.message==="object"){t.headers["Content-Type"]=u;t.message=JSON.stringify(e.message)}else{t.message=e.message}return t}function C(){var e,t,r={};for(t in l){e=l[t];if(!t.includes(" ")){t="GET "+t}if(Array.isArray(e)){r[t]=e.map(R)}else{r[t]=[R(e)]}}return r}function w(e){if(/\.xml$/.test(e)){return"application/xml"}if(/\.json$/.test(e)){return u}return"application/x-octet-stream"}function O(t,r,n){e.error(r.requestLine||r.method+" "+r.url,n,"sap.ui.test.TestUtils");return{code:t,headers:{"Content-Type":"text/plain"},message:n}}function D(e){return e.slice(0,e.indexOf("\r\n"))}function S(e,t){var r=[""];e.parts.every(function(e){r.push(e.boundary?"\r\nContent-Type: multipart/mixed;boundary="+e.boundary+"\r\n\r\n"+S(e,t):A(e,t));return!e.code||e.code<400||t.DataServiceVersion==="2.0"});r.push("--\r\n");return r.join("--"+e.boundary)}function A(e,t){var r=s.extend({},t,e.headers);return f+(e.contentId?"Content-ID: "+e.contentId+"\r\n":"")+"\r\nHTTP/1.1 "+e.code+" \r\n"+Object.keys(r).map(function(e){return e+": "+r[e]}).join("\r\n")+"\r\n\r\n"+(e.message||"")+"\r\n"}function M(t,r){var n,s,i=t+" "+r;if(b[i]){return{responses:b[i]}}if(!x){return undefined}n=[];s=x.filter(function(e){var t=i.match(e.regExp);if(t){n.push(t)}return t});if(s.length>1){e.warning("Multiple matches found for "+i,undefined,"sap.ui.test.TestUtils");return undefined}return s.length?{responses:s[0].response,match:n[0]}:undefined}function k(e){var t,r={};for(t in e.requestHeaders){if(E.test(t)){r[t]=e.requestHeaders[t]}}return r}function H(r,n){var i,a=M(r.method,r.url),o,c=a&&a.responses;c=(c||[]).filter(function(e){if(typeof e.ifMatch==="function"){return e.ifMatch(r)}return!e.ifMatch||e.ifMatch.test(r.requestBody)});if(c.length){o=c[0];if(typeof o.buildResponse==="function"){o=t({},o);o.buildResponse(a.match,o)}if(a.responses.length>1){i=a.responses.indexOf(o)}}else if(!m){switch(r.method){case"HEAD":o={code:200};break;case"DELETE":case"MERGE":case"PATCH":o={code:204};break;case"POST":o={code:200,headers:{"Content-Type":u},message:r.requestBody};break}}if(o){e.info(r.method+" "+r.url+(i!==undefined?", alternative (ifMatch) #"+i:""),'{"If-Match":'+JSON.stringify(r.requestHeaders["If-Match"])+"}","sap.ui.test.TestUtils")}else{o=O(404,r,"No mock data found")}o.headers=s.extend({},k(r),o.headers);if(n&&o.code<300){o.contentId=n}return o}function j(e,t){var r;t=t.replace(/^\s+/,"");r=D(t);return{boundary:D(t).slice(2),parts:t.split(r).slice(1,-1).map(function(t){var r,n,s,i,o,u;t=t.slice(2);n=D(t);if(p.test(n)){i=j(e,t.slice(n.length+4));r=i.parts.filter(function(e){return e.code>=300});return r.length?r[0]:i}u=t.indexOf("\r\n\r\n")+4;o=P(e,t.slice(u));s=a.exec(t.slice(0,u));return H(o,s&&s[1])})}}function P(e,t){var r=t.indexOf("\r\n\r\n"),n,s,i={requestHeaders:{}};i.requestBody=t.slice(r+4,t.length-2);t=t.slice(0,r);n=t.split("\r\n");i.requestLine=n.shift();s=g.exec(i.requestLine);if(s){i.method=s[1];i.url=e+s[2];n.forEach(function(e){var t=o.exec(e);if(t){i.requestHeaders[t[1]]=t[2]}})}return i}function L(e){var t=e.url;if(i.test(t)){q(t.slice(0,t.indexOf("/$batch")+1),e)}else{F(e)}}function U(e){var t=c[e];if(!t){s.ajax({async:false,url:e,dataType:"text",success:function(e){t=e}});if(!t){throw new Error(e+": resource not found")}c[e]=t}return t}function F(e){var t=H(e);v+=1;if(T){T(e.requestBody)}e.respond(t.code,t.headers,t.message)}function I(){var e,t;b=C();if(h){x=h.map(function(e){return{regExp:e.regExp,response:Array.isArray(e.response)?e.response.map(R):[R(e.response)]}})}t=sinon.fakeServer.create();if(r.getFakes){r.getFakes().push(t)}else{r.add(t)}t.autoRespond=true;if(d){t.autoRespondAfter=parseInt(d)}t.respondWith("GET",/./,F);t.respondWith("DELETE",/./,F);t.respondWith("HEAD",/./,F);t.respondWith("PATCH",/./,F);t.respondWith("MERGE",/./,F);t.respondWith("POST",/./,L);e=t.restore;t.restore=function(){sinon.FakeXMLHttpRequest.filters=[];e.apply(this,arguments)};sinon.xhr.supportsCORS=s.support.cors;sinon.FakeXMLHttpRequest.useFilters=true;sinon.FakeXMLHttpRequest.addFilter(function(e,t){var r=M(e,t)||(y?t.startsWith(y)||i.test(t):e==="DELETE"||e==="HEAD"||e==="MERGE"||e==="PATCH"||e==="POST");return!r});return t}n=sap.ui.require.toUrl(n).replace(/(^|\/)resources\/(~[-a-zA-Z0-9_.]*~\/)?/,"$1test-resources/")+"/";return I()},withNormalizedMessages:function(e){var t;if(sinon.createSandbox){t=sinon.createSandbox()}else{t=sinon.sandbox.create()}try{var r=sap.ui.getCore(),n=r.getLibraryResourceBundle;t.stub(r,"getLibraryResourceBundle").returns({getText:function(e,t){var s=e,i=n.call(r).getText(e),a;for(a=0;a<10;a+=1){if(i.indexOf("{"+a+"}")>=0){s+=" "+(a>=t.length?"{"+a+"}":t[a])}}return s}});e.apply(this)}finally{t.verifyAndRestore()}},isOptimisticBatch:function(){return q},isRealOData:function(){if(h==="proxy"){throw new Error("realOData=proxy is no longer supported")}return x},isSupportAssistant:function(){return R},getRealOData:function(){return h?"&realOData="+h:""},getRequestCount:function(){return v},onRequest:function(e){T=e},proxy:function(t){e.warning("#proxy is no longer supported",null,"sap.ui.test.TestUtils");return t},resetRequestCount:function(){v=0},retrieveData:function(e){var t=m[e];delete m[e];return t},setData:function(e,t){m[e]=t},setupODataV4Server:function(e,t,r,n,s){var i={};if(this.isRealOData()){return}if(!n){n="/"}else if(n.slice(-1)!=="/"){n+="/"}Object.keys(t).forEach(function(e){var r=y.exec(e),s,a;if(r){s=r[1]||"GET";a=r[2]}else{s="GET";a=e}if(!a.startsWith("/")){a=n+a}i[s+" "+a]=t[e]});C.useFakeServer(e,r||"sap/ui/core/qunit/odata/v4/data",i,s,n!=="/"?n:undefined)},spyFetch:function(e){var t=e.spy(XMLHttpRequest.prototype,"open");t.calledWithUrl=function(e){return t.getCall(e).args[1]};return t}};return C},true);