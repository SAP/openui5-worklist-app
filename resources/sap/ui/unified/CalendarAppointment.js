/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./DateTypeRange","sap/ui/core/format/DateFormat","sap/ui/core/format/NumberFormat","sap/ui/core/format/TimezoneUtil","sap/ui/core/Core","./calendar/CalendarUtils","./library","sap/base/Log","sap/ui/core/Configuration"],function(t,e,i,n,a,o,r,u,g){"use strict";var p=t.extend("sap.ui.unified.CalendarAppointment",{metadata:{library:"sap.ui.unified",properties:{title:{type:"string",group:"Data"},text:{type:"string",group:"Data"},description:{type:"string",group:"Data"},icon:{type:"sap.ui.core.URI",group:"Data",defaultValue:null},tentative:{type:"boolean",group:"Data",defaultValue:false},selected:{type:"boolean",group:"Data",defaultValue:false},key:{type:"string",group:"Data",defaultValue:null},color:{type:"sap.ui.core.CSSColor",group:"Appearance",defaultValue:null}},aggregations:{customContent:{type:"sap.ui.core.Control",multiple:true}}}});p.prototype.init=function(){this._sAppointmentPartSuffix=null};p.prototype.applyFocusInfo=function(t){var e=this.getParent();if(e){e.applyFocusInfo(t)}return this};p.prototype._getDateRangeIntersectionText=function(t){var n=this._getStartDateWithTimezoneAdaptation(),a=this._getEndDateWithTimezoneAdaptation()?this._getEndDateWithTimezoneAdaptation():new Date(864e12),o,r,u=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0),p=new Date(u.getFullYear(),u.getMonth(),u.getDate()+1),s=e.getTimeInstance({pattern:"HH:mm"}),m=sap.ui.getCore().getLibraryResourceBundle("sap.m"),l=i.getUnitInstance({allowedUnits:["duration-hour"]},g.getFormatSettings().getFormatLocale()),f=i.getUnitInstance({allowedUnits:["duration-minute"]},g.getFormatSettings().getFormatLocale()),T,d,c,h;if(n.getTime()>=p.getTime()||a.getTime()<=u.getTime()){o=""}else if(n.getTime()<=u.getTime()&&a.getTime()>=p.getTime()){o=m.getText("PLANNINGCALENDAR_ALLDAY")}else if(n.getTime()<u.getTime()){o=m.getText("PLANNINGCALENDAR_UNTIL");r=s.format(a)}else if(a.getTime()>p.getTime()){o=m.getText("PLANNINGCALENDAR_FROM");r=s.format(n)}else{o=s.format(n);if(a.getTime()-n.getTime()<36e5){d=(a.getTime()-n.getTime())/6e4;r=f.format(d,"duration-minute")}else if((a.getTime()-n.getTime())%36e5===0){T=(a.getTime()-n.getTime())/36e5;r=l.format(T,"duration-hour")}else{T=Math.floor((a.getTime()-n.getTime())/36e5);c=l.format(T,"duration-hour");d=(a.getTime()-n.getTime())/6e4%60;h=f.format(d,"duration-minute");r=m.getText("PLANNINGCALENDAR_APP_DURATION",[c,h])}}return{start:o,end:r}};p._getComparer=function(t){var e=24*60*60*1e3,i=new Date(t.getFullYear(),t.getMonth(),t.getDate(),0,0,0).getTime(),n=i+e;return function(t,e){var a=t.appointment._getStartDateWithTimezoneAdaptation().getTime(),o=e.appointment._getStartDateWithTimezoneAdaptation().getTime(),r=t.appointment._getEndDateWithTimezoneAdaptation()?t.appointment._getEndDateWithTimezoneAdaptation().getTime():864e12,u=e.appointment._getEndDateWithTimezoneAdaptation()?e.appointment._getEndDateWithTimezoneAdaptation().getTime():864e12,g=a<=i&&r>=n,p=o<=i&&u>=n,s;if(g&&p||!g&&!p){s=a-o;if(s===0){s=u-r}}else if(g){s=-1}else{s=1}return s}};p.prototype.setColor=function(t){if(t&&!t.match(/^#[0-9a-f]{6}$/i)){u.warning("setColor accepts only full hex color value with pound symbol, but value is '"+t+"'")}return this.setProperty("color",t)};p.prototype._getCSSColorForBackground=function(t){return"rgba("+[parseInt(t.substr(1,2),16),parseInt(t.substr(3,2),16),parseInt(t.substr(5,2),16)].join(",")+", 0.2)"};p.prototype._setAppointmentPartSuffix=function(t){this._sAppointmentPartSuffix=t;return this};p.prototype.getDomRef=function(t){if(document.getElementById(this.getId())){return document.getElementById(t?this.getId()+"-"+t:this.getId())}else if(this._sAppointmentPartSuffix){return document.getElementById(t?this.getId()+"-"+this._sAppointmentPartSuffix+"-"+t:this.getId()+"-"+this._sAppointmentPartSuffix)}var e=document.querySelectorAll(".sapUiCalendarRowApps[id^='"+this.getId()+"']");return e.length>0?e[0]:null};p.prototype._getEndDateWithTimezoneAdaptation=function(){if(!this.getProperty("endDate")){return null}var t=this._convertToTimezone(this.getEndDate());return t};p.prototype._getStartDateWithTimezoneAdaptation=function(){if(!this.getProperty("startDate")){return null}var t=this._convertToTimezone(this.getStartDate());return t};p.prototype._convertToTimezone=function(t){var e=a.getConfiguration().getTimezone();var i=o._createUniversalUTCDate(t,undefined,true);i=new Date(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),t.getUTCHours(),t.getUTCMinutes(),t.getUTCSeconds());i.setUTCFullYear(t.getUTCFullYear());i=n.convertToTimezone(i,e);return i};return p});