/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarAppointment","sap/ui/unified/CalendarLegendRenderer","sap/ui/Device","sap/ui/unified/library","sap/ui/core/InvisibleText","sap/base/Log","sap/ui/core/IconPool"],function(e,t,a,n,i,r,s){"use strict";var o=i.CalendarDayType;var l=i.CalendarIntervalType;var p=i.CalendarAppointmentVisualization;var d=i.CalendarAppointmentHeight;var g={apiVersion:2};g.render=function(e,t){var a=t.getTooltip_AsString();var i=t.getAppointmentsVisualization();var r=this.getLegendItems(t);e.openStart("div",t);e.class("sapUiCalendarRow");if(!n.system.phone&&t.getAppointmentsReducedHeight()){e.class("sapUiCalendarRowAppsRedHeight")}if(i!=p.Standard){e.class("sapUiCalendarRowVis"+i)}if(a){e.attr("title",a)}var s=t.getWidth();if(s){e.style("width",s)}var o=t.getHeight();if(o){e.style("height",o)}e.accessibilityState(t);e.openEnd();this.renderAppointmentsRow(e,t,r);e.close("div")};g.renderAppointmentsRow=function(e,t,a){var n=t.getId();e.openStart("div",n+"-Apps");e.class("sapUiCalendarRowApps");e.openEnd();this.renderBeforeAppointments(e,t);this.renderAppointments(e,t,a);this.renderAfterAppointments(e,t);e.close("div")};g.renderBeforeAppointments=function(e,t){};g.renderAfterAppointments=function(e,t){};g.renderResizeHandle=function(e,t,a){};g.renderAppointments=function(t,a,n){var i=a._getVisibleAppointments();var r=a._getVisibleIntervalHeaders();var s=a._getStartDate();var o=[];var p=0;var d=0;var g=[];var c=0;var v=0;var f=a.getIntervals();var A=a.getIntervalType();var u=100/f;var C=0;var T=new e(s);var h=false;var I=false;switch(A){case l.Hour:o=a.getNonWorkingHours()||[];p=s.getUTCHours();d=24;break;case l.Day:case l.Week:case l.OneMonth:case"OneMonth":o=a._getNonWorkingDays();p=s.getUTCDay();d=7;g=a.getNonWorkingHours()||[];c=s.getUTCHours();v=24;break;case l.Month:g=a._getNonWorkingDays();c=s.getUTCDay();v=7;break;default:break}if(a._isOneMonthsRowOnSmallSizes()){this.renderSingleDayInterval(t,a,i,n,r,o,p,d,g,c,v,true,true)}else{for(C=0;C<f;C++){if(I){h=true}else{h=false}I=false;switch(A){case l.Hour:T.setUTCHours(T.getUTCHours()+1);if(T.getUTCHours()==0){I=true}break;case l.Day:case l.Week:case l.OneMonth:case"OneMonth":T.setUTCDate(T.getUTCDate()+1);if(T.getUTCDate()==1){I=true}break;case l.Month:c=T.getUTCDay();T.setUTCMonth(T.getUTCMonth()+1);if(T.getUTCMonth()==0){I=true}break;default:break}this.renderInterval(t,a,C,u,r,o,p,d,g,c,v,h,I)}this.renderIntervalHeaders(t,a,u,r,f);if(!(a._getRelativeInfo&&a._getRelativeInfo().bIsRelative)){t.openStart("div",a.getId()+"-Now");t.class("sapUiCalendarRowNow");t.openEnd();t.close("div")}for(C=0;C<i.length;C++){var m=i[C];this.renderAppointment(t,a,m,n)}t.openStart("div",a.getId()+"-DummyApp");t.class("sapUiCalendarApp");t.class("sapUiCalendarAppTitleOnly");t.class("sapUiCalendarAppDummy");t.class("sapUiCalendarAppHeight1");t.openEnd();t.close("div")}};g.writeCustomAttributes=function(e,t){};g.renderInterval=function(t,a,n,i,r,s,o,p,d,g,c,v,f,A){var u=a.getId()+"-AppsInt"+n;var C;var T=a.getShowIntervalHeaders()&&(a.getShowEmptyIntervalHeaders()||r.length>0);var h=a.getStartDate().getMonth();var I=new Date(a.getStartDate().getFullYear(),h+1,0).getDate();t.openStart("div",u);t.class("sapUiCalendarRowAppsInt");if(A){t.class(A)}t.style("width",i+"%");if(n>=I&&(a.getIntervalType()===l.OneMonth||a.getIntervalType()==="OneMonth")){t.class("sapUiCalItemOtherMonth")}for(C=0;C<s.length;C++){if((n+o)%p==s[C]){t.class("sapUiCalendarRowAppsNoWork");break}}if(!T){t.class("sapUiCalendarRowAppsIntNoHead")}if(v){t.class("sapUiCalendarRowAppsIntFirst")}if(f){t.class("sapUiCalendarRowAppsIntLast")}this.writeCustomAttributes(t,a);t.openEnd();if(T){t.openStart("div");t.class("sapUiCalendarRowAppsIntHead");t.openEnd();t.close("div")}if(a.getShowSubIntervals()){var m=a.getIntervalType();var U=0;switch(m){case l.Hour:U=4;break;case l.Day:case l.Week:case l.OneMonth:case"OneMonth":U=24;break;case l.Month:var b=a._getStartDate();var S=new e(b);S.setUTCMonth(S.getUTCMonth()+n+1,0);U=S.getUTCDate();S.setUTCDate(1);o=S.getUTCDay();break;default:break}var R=100/U;for(C=0;C<U;C++){t.openStart("div");t.class("sapUiCalendarRowAppsSubInt");t.style("width",R+"%");for(var y=0;y<d.length;y++){if((C+g)%c==d[y]){t.class("sapUiCalendarRowAppsNoWork");break}}t.openEnd();t.close("div")}}t.close("div")};g.renderIntervalHeaders=function(e,t,a,n,i){var r=t.getShowIntervalHeaders()&&(t.getShowEmptyIntervalHeaders()||n.length>0);if(r){for(var s=0;s<n.length;s++){var o=n[s],l,p;if(t._bRTL){p=a*o.interval;l=a*(i-o.last-1)}else{l=a*o.interval;p=a*(i-o.last-1)}this.renderIntervalHeader(e,t,o,t._bRTL,l,p)}}};g.renderIntervalHeader=function(e,t,a,n,i,r){var s=a.appointment.getId(),l={labelledby:{value:s+"-Descr",append:true}},p;var d=t._calculateAppoitnmentVisualCue(a.appointment);e.openStart("div",a.appointment);e.class("sapUiCalendarRowAppsIntHead");if(i!==undefined){e.style("left",i+"%")}if(r!==undefined){e.style("right",r+"%")}e.class("sapUiCalendarRowAppsIntHeadFirst");if(a.appointment.getSelected()){e.class("sapUiCalendarRowAppsIntHeadSel")}if(a.appointment.getTentative()){e.class("sapUiCalendarRowAppsIntHeadTent")}var g=a.appointment.getTooltip_AsString();if(g){e.attr("title",g)}var c=a.appointment.getType();var v=a.appointment.getColor();if(!v&&c&&c!=o.None){e.class("sapUiCalendarRowAppsIntHead"+c)}if(v){if(n){e.style("border-right-color",v)}else{e.style("border-left-color",v)}}e.accessibilityState(a.appointment,l);e.openEnd();e.openStart("div");e.class("sapUiCalendarIntervalHeaderCont");if(v){e.style("background-color",a.appointment._getCSSColorForBackground(v))}e.openEnd();if(d.appTimeUnitsDifRowStart>0){e.icon("sap-icon://arrow-left",["sapUiCalendarAppArrowIconLeft"],{title:null,role:"img"})}var f=a.appointment.getIcon();if(f){var A=["sapUiCalendarRowAppsIntHeadIcon"];var u={};u["id"]=s+"-Icon";u["title"]=null;u["alt"]=null;u["role"]="presentation";e.icon(f,A,u)}var C=a.appointment.getTitle();if(C){e.openStart("span",s+"-Title");e.class("sapUiCalendarRowAppsIntHeadTitle");e.openEnd();e.text(C);e.close("span")}var T=a.appointment.getText();if(T){e.openStart("span",s+"-Text");e.class("sapUiCalendarRowAppsIntHeadText");e.openEnd();e.text(T);e.close("span")}if(d.appTimeUnitsDifRowEnd>0){e.icon("sap-icon://arrow-right",["sapUiCalendarAppArrowIconRight"],{title:null,role:"img"})}p=t._oRb.getText("CALENDAR_START_TIME")+": "+t._oFormatAria.format(a.appointment._getStartDateWithTimezoneAdaptation())+"; "+t._oRb.getText("CALENDAR_END_TIME")+": "+t._oFormatAria.format(a.appointment._getEndDateWithTimezoneAdaptation());if(c&&c!==o.None){p+="; "+this.getAriaTextForType(c,this.getLegendItems(t))}e.openStart("span",s+"-Descr");e.class("sapUiInvisibleText");e.openEnd();e.text(p);e.close("span");e.close("div");e.close("div")};g.renderAppointment=function(e,t,a,n,i){var s=a.appointment;var l=s.getTooltip_AsString();var g=s.getType();var c=s.getColor();var v=s.getTitle();var f=s.getText();var A=s.getDescription();var u=s.getIcon();var C=s.getId();var T=t._getAppointmentReducedHeight(a);var h={labelledby:{value:r.getStaticId("sap.ui.unified","APPOINTMENT")+" "+C+"-Descr",append:true},selected:null};var I=t._getAppointmentRowCount(a,T);var m=t.getAriaLabelledBy();var U=t._calculateAppoitnmentVisualCue(s);if(m.length>0){h["labelledby"].value=h["labelledby"].value+" "+m.join(" ")}if(v){h["labelledby"].value=h["labelledby"].value+" "+C+"-Title"}if(f){h["labelledby"].value=h["labelledby"].value+" "+C+"-Text"}e.openStart("div",s);e.class("sapUiCalendarApp");e.class("sapUiCalendarAppHeight"+I);if(s.getSelected()){e.class("sapUiCalendarAppSel");h["labelledby"].value=h["labelledby"].value+" "+r.getStaticId("sap.ui.unified","APPOINTMENT_SELECTED")}if(s.getTentative()){e.class("sapUiCalendarAppTent");h["labelledby"].value=h["labelledby"].value+" "+r.getStaticId("sap.ui.unified","APPOINTMENT_TENTATIVE")}if(I===1){e.class("sapUiCalendarAppTitleOnly")}if(u){e.class("sapUiCalendarAppWithIcon")}if(!i){if(t._bRTL){e.style("right",a.begin+"%");e.style("left",a.end+"%")}else{e.style("left",a.begin+"%");e.style("right",a.end+"%")}}e.attr("data-sap-level",a.level);if(t._sFocusedAppointmentId==C){e.attr("tabindex","0")}else{e.attr("tabindex","-1")}if(l){e.attr("title",l)}if(!c&&g&&g!=o.None){e.class("sapUiCalendarApp"+g)}if(c){if(t._bRTL){e.style("border-right-color",c)}else{e.style("border-left-color",c)}}e.accessibilityState(s,h);e.openEnd();e.openStart("div");e.class("sapUiCalendarAppCont");if(c&&t.getAppointmentsVisualization()===p.Filled){e.style("background-color",s._getCSSColorForBackground(c))}e.openEnd();if(s.getCustomContent().length){s.getCustomContent().forEach(function(t){e.renderControl(t)})}else{if(U.appTimeUnitsDifRowStart>0){e.icon("sap-icon://arrow-left",["sapUiCalendarAppArrowIconLeft"],{title:null,role:"img"})}if(u){var b=["sapUiCalendarAppIcon"];var S={};S["id"]=C+"-Icon";S["title"]=null;S["alt"]=null;S["role"]="presentation";e.icon(u,b,S)}e.openStart("div");e.class("sapUiCalendarAppTitleWrapper");e.openEnd();if(v){e.openStart("span",C+"-Title");e.class("sapUiCalendarAppTitle");e.openEnd();e.text(v);e.close("span")}if(f&&a.size!==d.HalfSize){e.openStart("span",C+"-Text");e.class("sapUiCalendarAppText");e.openEnd();e.text(f);e.close("span")}if(A&&a.size!==d.HalfSize&&(a.size!==d.Regular||!f)){e.openStart("span",C+"-Info");e.class("sapUiCalendarAppDescription");e.openEnd();e.text(A);e.close("span")}e.close("div");if(U.appTimeUnitsDifRowEnd>0){e.icon("sap-icon://arrow-right",["sapUiCalendarAppArrowIconRight"],{title:null,role:"img"})}}var R=t._oRb.getText("CALENDAR_START_TIME")+": "+t._oFormatAria.format(s._getStartDateWithTimezoneAdaptation());R=R+"; "+t._oRb.getText("CALENDAR_END_TIME")+": "+t._oFormatAria.format(s._getEndDateWithTimezoneAdaptation());if(t._getRelativeInfo&&t._getRelativeInfo().bIsRelative){var y=t._getRelativeInfo();R=t._oRb.getText("CALENDAR_START_TIME")+": "+y.intervalLabelFormatter(y._getIndexFromDate(s._getStartDateWithTimezoneAdaptation()));R=R+"; "+t._oRb.getText("CALENDAR_END_TIME")+": "+y.intervalLabelFormatter(y._getIndexFromDate(s._getEndDateWithTimezoneAdaptation()))}if(g&&g!=o.None){R=R+"; "+this.getAriaTextForType(g,n)}e.openStart("span",C+"-Descr");e.class("sapUiInvisibleText");e.openEnd();e.text(R);e.close("span");e.close("div");this.renderResizeHandle(e,t,s);e.close("div")};g.renderSingleDayInterval=function(a,n,i,r,s,o,p,d,g,c,v,f,A){var u=1,C=100,T=n.getId()+"-AppsInt"+u,h,I=n.getShowIntervalHeaders()&&(n.getShowEmptyIntervalHeaders()||s.length>0),m=new Date(n.getStartDate()),U=m.getMonth(),b=new Date(m.getFullYear(),U+1,0).getDate(),S,R=n._getPlanningCalendar(),y,w,_=[];m.setHours(0,0,0,0);y=i.concat(n.getIntervalHeaders().filter(function(e){var t=e._getStartDateWithTimezoneAdaptation().getTime(),a=e._getEndDateWithTimezoneAdaptation().getTime(),n=m.getTime(),i=n+1e3*60*60*24;return!(t>=i||a<=n)}).map(function(e){return{appointment:e,isHeader:true}})).sort(t._getComparer(m));if(R){_=R._getSelectedDates()}a.openStart("div",T);a.class("sapUiCalendarRowAppsInt");a.class("sapUiCalendarMonthRowAppsS");a.style("width",C+"%");if(u>=b&&(n.getIntervalType()===l.OneMonth||n.getIntervalType()==="OneMonth")){a.class("sapUiCalItemOtherMonth")}for(h=0;h<o.length;h++){if((u+p)%d==o[h]){a.class("sapUiCalendarRowAppsNoWork");break}}if(!I){a.class("sapUiCalendarRowAppsIntNoHead")}if(f){a.class("sapUiCalendarRowAppsIntFirst")}if(A){a.class("sapUiCalendarRowAppsIntLast")}a.openEnd();if(I){a.openStart("div");a.class("sapUiCalendarRowAppsIntHead");a.openEnd();a.close("div")}if(_.length>0){var D=0,E=y.length;if(R.getRows()[0]._calculateVisibleAppointments){var H=R.getRows()[0]._calculateVisibleAppointments(_,y);D=H.iStart;E=H.iEnd}for(h=D;h<E;h++){w=y[h];a.openStart("div");a.class("sapUiCalendarAppContainer");a.openEnd();a.openStart("div");a.class("sapUiCalendarAppContainerLeft");a.openEnd();a.openStart("div");a.class("sapUiCalendarAppStart");a.openEnd();a.text(w.appointment._getDateRangeIntersectionText(m).start);a.close("div");a.openStart("div");a.class("sapUiCalendarAppEnd");a.openEnd();a.text(w.appointment._getDateRangeIntersectionText(m).end);a.close("div");a.close("div");a.openStart("div");a.class("sapUiCalendarAppContainerRight");a.openEnd();if(w.isHeader){this.renderIntervalHeader(a,n,w)}else{this.renderAppointment(a,n,w,r,true)}a.close("div");a.close("div")}}if(i.length===0||_.length===0){a.openStart("div");a.class("sapUiCalendarNoApps");a.openEnd();var N=sap.ui.getCore().byId(n.getAssociation("row"));S=N.getNoAppointmentsText()?N.getNoAppointmentsText():sap.ui.getCore().getLibraryResourceBundle("sap.m").getText("PLANNINGCALENDAR_ROW_NO_APPOINTMENTS");a.text(S);a.close("div")}if(!(n._getRelativeInfo&&n._getRelativeInfo().bIsRelative)){a.openStart("div",n.getId()+"-Now");a.class("sapUiCalendarRowNow");a.openEnd()}a.close("div");a.openStart("div",n.getId()+"-DummyApp");a.class("sapUiCalendarApp");a.class("sapUiCalendarAppTitleOnly");a.class("sapUiCalendarAppDummy");a.style("margin","0");a.style("height","0px");a.openEnd();a.close("div");if(n.getShowSubIntervals()){var x=n.getIntervalType();var M=0;switch(x){case l.Hour:M=4;break;case l.Day:case l.Week:case l.OneMonth:case"OneMonth":M=24;break;case l.Month:var k=new e(m);k.setUTCMonth(k.getUTCMonth()+u+1,0);M=k.getUTCDate();k.setUTCDate(1);p=k.getUTCDay();break;default:break}var L=100/M;for(h=0;h<M;h++){a.openStart("div");a.class("sapUiCalendarRowAppsSubInt");a.style("width",L+"%");for(var O=0;O<g.length;O++){if((h+c)%v==g[O]){a.class("sapUiCalendarRowAppsNoWork");break}}a.openEnd();a.close("div")}}a.close("div")};g.getLegendItems=function(e){var t=[],a,n=e.getLegend();if(n){a=sap.ui.getCore().byId(n);if(a){t=a.getItems()}else{s.error("CalendarLegend with id '"+n+"' does not exist!",e)}}return t};g.getAriaTextForType=function(e,t){var n,i,r,s;if(t&&t.length){for(var s=0;s<t.length;s++){r=t[s];if(r.getType()===e){n=r.getText();break}}}if(!n){i=a.getTypeAriaText(e);if(i){n=i.getText()}}return n};return g},true);