/*!
 * OpenUI5
 * (c) Copyright 2009-2022 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/unified/calendar/CalendarUtils","sap/ui/core/format/TimezoneUtil","sap/ui/core/Core","sap/ui/core/date/UniversalDate","sap/ui/unified/CalendarLegendRenderer","sap/ui/unified/library","sap/base/Log"],function(e,t,a,r,i,n,s){"use strict";var o=n.CalendarDayType;var l={apiVersion:2};l.render=function(e,t){var a=t._getStartDate();var r=t.getTooltip_AsString();var i=t.getId();var n={value:i+"-Descr",append:true};e.openStart("div",t);e.class("sapUiCalTimesRow");e.class("sapUiCalRow");if(r){e.attr("title",r)}if(t._getShowHeader()){n.value=n.value+" "+i+"-Head"}e.accessibilityState(t,{role:"grid",readonly:"true",multiselectable:!t.getSingleSelection()||t.getIntervalSelection(),labelledby:n});e.openEnd();e.openStart("span",i+"-Descr");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_DIALOG"));e.close("span");if(t.getIntervalSelection()){e.openStart("span",i+"-Start");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_START_TIME"));e.close("span");e.openStart("span",i+"-End");e.style("display","none");e.openEnd();e.text(t._rb.getText("CALENDAR_END_TIME"));e.close("span")}this.renderRow(e,t,a);e.close("div")};l.renderRow=function(e,t,a){var r=t.getId();this.renderHeader(e,t,a);e.openStart("div",r+"-times");e.class("sapUiCalItems");e.attr("role","row");e.openEnd();this.renderTimes(e,t,a);e.close("div")};l.renderHeader=function(e,t,a){if(t._getShowHeader()){var r=t._getLocaleData();var i=t.getId();e.openStart("div",i+"-Head");e.openEnd();this.renderHeaderLine(e,t,r,a);e.close("div")}};l.renderHeaderLine=function(e,t,a,r){var i=t._getFormatDate();var n=t.getId();var s=t.getItems();var o=t._getIntervalStart(r);var l=t.getIntervalMinutes();var d="";var c=0;var p=[];var m=0;for(m=0;m<s;m++){c=i.format(o,true);if(p.length>0&&p[p.length-1].sDay==c){p[p.length-1].iItems++}else{p.push({sDay:c,iItems:1})}o.setUTCMinutes(o.getUTCMinutes()+l)}for(m=0;m<p.length;m++){var g=p[m];d=100/s*g.iItems+"%";e.openStart("div",n+"-Head"+m);e.class("sapUiCalHeadText");e.style("width",d);e.openEnd();e.text(g.sDay);e.close("div")}};l._convertToTimezone=function(r){var i=a.getConfiguration().getTimezone();var n=e._createUniversalUTCDate(r,undefined,true);n=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds());n.setUTCFullYear(r.getUTCFullYear());n=t.convertToTimezone(n,i);return n};l.renderTimes=function(e,t,a){var r=this.getHelper(t,a);var i=t.getItems();var n=100/i+"%";var s=t._getIntervalStart(a);var o="";var l="";for(var d=0;d<i;d++){if(r.oFormatTimeAmPm){l=r.oFormatTimeAmPm.format(s,true);if(o==l){l=""}else{o=l}}this.renderTime(e,t,s,r,n,l);s.setUTCMinutes(s.getUTCMinutes()+r.iMinutes)}};l.getHelper=function(t,a){var r={};r.sLocale=t._getLocale();r.oLocaleData=t._getLocaleData();r.oNow=e._createUniversalUTCDate(new Date,undefined,true);r.sCurrentTime=t._rb.getText("CALENDAR_CURRENT_TIME");r.sId=t.getId();r.oFormatLong=t._getFormatLong();r.oFormatTime=t._getFormatTime();r.oFormatTimeAmPm=t._oFormatTimeAmPm;r.iMinutes=t.getIntervalMinutes();var i=t.getLegend();if(i){var n=sap.ui.getCore().byId(i);if(n){if(!(n instanceof sap.ui.unified.CalendarLegend)){throw new Error(n+" is not an sap.ui.unified.CalendarLegend. "+t)}r.oLegend=n}else{s.warning("CalendarLegend "+i+" does not exist!",t)}}r.oNow=this._convertToTimezone(new Date);return r};l.renderTime=function(e,t,a,n,s,l){var d=t._getAriaRole();var c={role:d,selected:d!=="gridcell"?null:false,label:"",describedby:""};var p=t._oFormatYyyyMMddHHmm.format(a.getJSDate(),true);var m=t._checkDateSelected(a);var g=t._getDateType(a);var u=t._checkTimeEnabled(a);e.openStart("div",n.sId+"-"+p);e.class("sapUiCalItem");if(s){e.style("width",s)}var v=new r(a.getTime());v.setUTCMinutes(v.getUTCMinutes()+n.iMinutes);if(a.getTime()<=n.oNow.getTime()&&v.getTime()>n.oNow.getTime()){e.class("sapUiCalItemNow");c["label"]=n.sCurrentTime+" "}if(m>0){e.class("sapUiCalItemSel");if(d==="gridcell"){c["selected"]=true}}if(m==2){e.class("sapUiCalItemSelStart");c["describedby"]=c["describedby"]+" "+n.sId+"-Start"}else if(m==3){e.class("sapUiCalItemSelEnd");c["describedby"]=c["describedby"]+" "+n.sId+"-End"}else if(m==4){e.class("sapUiCalItemSelBetween")}else if(m==5){e.class("sapUiCalItemSelStart");e.class("sapUiCalItemSelEnd");c["describedby"]=c["describedby"]+" "+n.sId+"-Start";c["describedby"]=c["describedby"]+" "+n.sId+"-End"}if(g&&g.type!=o.None){e.class("sapUiCalItem"+g.type);if(g.tooltip){e.attr("title",g.tooltip)}}if(!u){e.class("sapUiCalItemDsbl");c["disabled"]=true}e.attr("tabindex","-1");e.attr("data-sap-time",p);c["label"]=c["label"]+n.oFormatLong.format(a,true);if(g&&g.type!=o.None){i.addCalendarTypeAccInfo(c,g.type,n.oLegend)}e.accessibilityState(null,c);e.openEnd();if(g&&g.type!=o.None){e.openStart("div");e.class("sapUiCalSpecialDate");if(g.color){e.style("background-color",g.color)}e.openEnd();e.close("div")}e.openStart("span");e.class("sapUiCalItemText");e.openEnd();e.text(n.oFormatTime.format(a,true));if(l){e.openStart("span");e.class("sapUiCalItemTextAmPm");e.openEnd();e.text(l);e.close("span")}e.close("span");e.close("div")};return l},true);